(function(g){var window=this;'use strict';var wD$=function(F){var k=new g.Ct("und",new g.qs("Default","und",!0));k.captionTracks=F.captionTracks;return k},mrn=function(F){return new g.Uz(function(k,z){var x=F.length,D=[];
if(x)for(var e=function(X,q){x--;D[X]=q;x==0&&k(D)},C=function(X){z(X)},p,E=0;E<F.length;E++)p=F[E],g.MYa(p,g.FY(e,E),C);
else k(D)})},If=function(F){this.Y=F},H_=function(){If.apply(this,arguments)},TlD=function(){H_.apply(this,arguments)},lEt=function(){H_.apply(this,arguments)},Q49=function(){H_.apply(this,arguments)},hOC=function(){H_.apply(this,arguments)},s4C=function(){H_.apply(this,arguments)},raC=function(){H_.apply(this,arguments)},BlH=function(){If.apply(this,arguments)},GiV=function(){H_.apply(this,arguments)},Ur$=function(){H_.apply(this,arguments)},tKV=function(){H_.apply(this,arguments)},Zf$=function(){H_.apply(this,
arguments)},vDH=function(){H_.apply(this,arguments)},caC=function(){H_.apply(this,arguments)},P8$=function(){H_.apply(this,arguments)},OfC=function(){H_.apply(this,arguments)},VK9=function(){H_.apply(this,arguments)},IEV=function(){H_.apply(this,arguments)},Hf7=function(){H_.apply(this,arguments)},aE$=function(){H_.apply(this,arguments)},SFH=function(){If.apply(this,arguments)},bf7=function(){H_.apply(this,arguments)},drV=function(){H_.apply(this,arguments)},JaD=function(){H_.apply(this,arguments)},
yan=function(){H_.apply(this,arguments)},ROH=function(){H_.apply(this,arguments)},gD7=function(){H_.apply(this,arguments)},YFC=function(){H_.apply(this,arguments)},nDn=function(){H_.apply(this,arguments)},MKn=function(){H_.apply(this,arguments)},L$G=function(){If.apply(this,arguments)},fEA=function(){If.apply(this,arguments)},K$n=function(){If.apply(this,arguments)},W$n=function(){H_.apply(this,arguments)},FG7=function(){H_.apply(this,arguments)},kyC=function(){H_.apply(this,arguments)},okG=function(){H_.apply(this,
arguments)},zrY=function(){H_.apply(this,arguments)},x2$=function(){H_.apply(this,arguments)},ic9=function(){H_.apply(this,arguments)},D2l=function(){H_.apply(this,arguments)},$2D=function(){H_.apply(this,arguments)},j67=function(){H_.apply(this,arguments)},erH=function(){H_.apply(this,arguments)},CQp=function(){H_.apply(this,arguments)},AWY=function(){H_.apply(this,arguments)},p8$=function(){H_.apply(this,arguments)},EkC=function(){H_.apply(this,arguments)},X8G=function(){H_.apply(this,arguments)},
qQn=function(){H_.apply(this,arguments)},NHp=function(){H_.apply(this,arguments)},umC=function(){H_.apply(this,arguments)},w8p=function(){H_.apply(this,arguments)},m2$=function(){H_.apply(this,arguments)},THH=function(){H_.apply(this,arguments)},lOV=function(){H_.apply(this,arguments)},Q6A=function(){H_.apply(this,arguments)},hrG=function(){H_.apply(this,arguments)},s6G=function(){H_.apply(this,arguments)},rWA=function(){If.apply(this,arguments)},BHY=function(){H_.apply(this,arguments)},GyC=function(){H_.apply(this,
arguments)},U2$=function(){H_.apply(this,arguments)},t3p=function(){H_.apply(this,arguments)},Zc9=function(){H_.apply(this,arguments)},vk$=function(){H_.apply(this,arguments)},cWn=function(){H_.apply(this,arguments)},PQ9=function(){H_.apply(this,arguments)},Oct=function(){H_.apply(this,arguments)},V3n=function(){H_.apply(this,arguments)},IO$=function(){H_.apply(this,arguments)},HcC=function(){H_.apply(this,arguments)},aOH=function(){H_.apply(this,arguments)},SQV=function(){H_.apply(this,arguments)},
bcA=function(){H_.apply(this,arguments)},d2Y=function(){H_.apply(this,arguments)},JW$=function(){H_.apply(this,arguments)},yWV=function(){H_.apply(this,arguments)},RrD=function(){H_.apply(this,arguments)},gkV=function(){H_.apply(this,arguments)},YQn=function(){H_.apply(this,arguments)},nk9=function(){H_.apply(this,arguments)},M37=function(){H_.apply(this,arguments)},LGH=function(){H_.apply(this,arguments)},fOG=function(){H_.apply(this,arguments)},KGC=function(){H_.apply(this,arguments)},WGD=function(){H_.apply(this,
arguments)},F8C=function(){H_.apply(this,arguments)},kO$=function(){H_.apply(this,arguments)},oQG=function(){H_.apply(this,arguments)},zip=function(){H_.apply(this,arguments)},xOD=function(){H_.apply(this,arguments)},iVG=function(F){F=F.key||F.id;
if(!F)throw Error("Entity key is missing");return F},DO$=function(){if(af)return af();
var F={};af=g.jA("PersistentEntityStoreDb",{C0:(F.EntityStore={Ot:1},F.EntityAssociationStore={Ot:2},F),shared:!1,upgrade:function(k,z){z(1)&&g.yE(g.HA(k,"EntityStore",{keyPath:"key"}),"entityType","entityType");z(2)&&(k=g.HA(k,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.yE(k,"byParentEntityKey","parentEntityKey"),g.yE(k,"byChildEntityKey","childEntityKey"))},
version:3});return af()},$Ol=function(F){return g.KM(DO$(),F)},jYH=function(F){return g.KM((0,g.fTC)(),F)},SV=function(F){this.token=F},b5=function(F,k){k=k===void 0?{}:k;
g.Fa.call(this,g.Kst[F],Object.assign({},{name:"PESEncoderError",type:F},k));this.type=F;this.level="WARNING";Object.setPrototypeOf(this,b5.prototype)},eiC=function(F){return new b5("WRONG_DATA_TYPE",{O$:F})},CUG=function(F){return F instanceof Error?new b5("UNKNOWN_ENCODE_ERROR",{xa:F.message}):new b5("UNKNOWN_ENCODE_ERROR")},A9A=function(F){return F instanceof Error?new b5("UNKNOWN_DECODE_ERROR",{xa:F.message}):new b5("UNKNOWN_DECODE_ERROR")},pSA=function(F,k){F=F instanceof b5?F:k(F);
g.JV(F);throw F;},EQV=function(){},XSY=function(F,k,z){try{return F.U(k,z)}catch(x){pSA(x,CUG)}},q0t=function(F){F=(new TextEncoder).encode(F).subarray(0,16);
var k=new Uint8Array(16);k.set(F);return k},dr=function(F){this.Y=F},urn=function(F){var k=NQD[F];
if(k)return k;g.yI(new g.Fa("Entity model not found.",{entityType:F}))},wSC=function(F,k){this.Y=F;
this.L=k;this.U={}},TQV=function(F,k){a:{F=mOC(F.L,k.version);
try{var z=F.L(k.data,k.key);break a}catch(x){pSA(x,A9A)}z=void 0}return z},Jp=function(F,k,z){return F.Y.objectStore("EntityStore").get(k).then(function(x){if(x){if(z&&x.entityType!==z)throw Error("Incorrect entity type");
return TQV(F,x)}})},yh=function(F,k,z){return z?(z=z.map(function(x){return Jp(F,x,k)}),g.vA.all(z)):F.Y.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(k)).then(function(x){return x.map(function(D){return TQV(F,D)})})},gr=function(F,k,z){var x=iVG(k),D=mOC(F.L,1),e=Object.assign({},k);
return F.Y.objectStore("EntityStore").get(x).then(function(C){if(C){if(C.entityType!==z)throw Error("Incorrect entity type");e.entityMetadata||(C=TQV(F,C),e.entityMetadata=C.entityMetadata)}}).then(function(){var C={key:x,
entityType:z,data:XSY(D,e,x),version:1};return g.vA.all([g.bM(F.Y.objectStore("EntityStore"),C),ltt(F,e,z)])}).then(function(){Rf(F,x,z);
return x})},QYV=function(F,k,z){k=k.map(function(x){return gr(F,x,z)});
return g.vA.all(k)},Yq=function(F,k,z){if(z==null?0:z.sZ){var x=new Set;
return hi9(F,k,x).then(function(){for(var e=[],C=g.l(x),p=C.next();!p.done;p=C.next())e.push(Yq(F,p.value));return g.vA.all(e).then(function(){})})}var D=g.xW(k).entityType;
return g.vA.all([F.Y.objectStore("EntityStore").delete(k),sYC(F,k)]).then(function(){Rf(F,k,D)})},r9A=function(F,k){return g.nM(F.Y.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(k)},function(z){return g.vA.all([z.delete(),
sYC(F,z.cursor.primaryKey)]).then(function(){Rf(F,z.cursor.primaryKey,k);return g.g3(z)})})},BQ$=function(F,k,z,x){var D=mOC(F.L,1);
return Jp(F,k,x).then(function(e){if(e){e=g.sP(e,z);var C={key:k,entityType:x,data:XSY(D,e,k),version:1};return g.vA.all([g.bM(F.Y.objectStore("EntityStore"),C),ltt(F,e,x)])}}).then(function(){Rf(F,k,x);
return k})},Rf=function(F,k,z){var x=F.U[z];
x||(x=new Set,F.U[z]=x);x.add(k)},GOt=function(F,k,z){var x=iVG(k);
z=urn(z);if(!z)return g.vA.resolve([]);z=new z(k);F=F.Y.objectStore("EntityAssociationStore");k=[];z=g.l(z.L());for(var D=z.next();!D.done;D=z.next())k.push(g.bM(F,{parentEntityKey:x,childEntityKey:D.value}));return g.vA.all(k).then(function(e){return e.map(function(C){return C[1]})})},sYC=function(F,k){return F.Y.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(k))},ltt=function(F,k,z){var x=iVG(k);
return sYC(F,x).then(function(){return GOt(F,k,z)})},hi9=function(F,k,z){if(z.has(k))return g.vA.resolve(void 0);
z.add(k);return UOD(F,k).then(function(x){return F.Y.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(k)).then(function(){return x})}).then(function(x){var D=g.vA.resolve(void 0);
x=g.l(x);for(var e=x.next(),C={};!e.done;C={FS:void 0},e=x.next())C.FS=e.value,D=D.then(function(p){return function(){return hi9(F,p.FS,z)}}(C));
return D}).then(function(){})},UOD=function(F,k){var z=F.Y.objectStore("EntityAssociationStore");
return z.index("byParentEntityKey").getAll(IDBKeyRange.only(k)).then(function(x){var D=[];x=g.l(x);for(var e=x.next();!e.done;e=x.next())e=e.value,D.push(z.index("byChildEntityKey").getAll(e.childEntityKey));return g.vA.all(D)}).then(function(x){var D=[];
x=g.l(x);for(var e=x.next();!e.done;e=x.next())e=e.value,e.length===1&&D.push(e[0].childEntityKey);return D})},nO=function(){},tUY=function(){this.Y={};
this.Y[0]=new nO;if(!g.sY("aes_pes_encoder_killswitch")){var F=this.Y;try{var k=g.kK();var z=q0t(k);var x=new dr(new g.Zc(z),new g.t5(z))}catch(D){throw F=D instanceof Error?new b5("KEY_CREATION_FAILED",{xa:D.message}):new b5("KEY_CREATION_FAILED"),g.JV(F),F;}F[1]=x}},mOC=function(F,k){k=k===void 0?0:k;
F=F.Y[k];if(!F)throw k=new b5("INVALID_ENCODER_VERSION",{O$:k}),g.JV(k),k;return F},MV=function(F,k){g.S.call(this);
this.token=F;this.Y=k;this.observers=[];F=new g.bD.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.kK());F.onmessage=this.L.bind(this);this.channel=F},LO=function(F,k,z){var x,D,e,C;
return g.O(function(p){if(p.Y==1)return g.c(p,$Ol(F.token),2);if(p.Y!=3)return x=p.L,g.c(p,g.SB(x,["EntityStore","EntityAssociationStore"],k,function(E){D=new wSC(E,F.Y);return z(D)}),3);
e=p.L;D&&(C=D.U,Object.keys(C).length>0&&(F.channel.postMessage(C),ZVD(F,C)));return p.return(e)})},fO=function(F,k,z){return LO(F,{mode:"readwrite",
nN:!0},function(x){return gr(x,k,z)})},vQp=function(F,k){return LO(F,{mode:"readwrite",
nN:!0},function(z){return QYV(z,k,"offlineOrchestrationActionWrapperEntity")})},c9V=function(F,k){return LO(F,{mode:"readwrite",
nN:!0},function(z){return Yq(z,k)})},PUD=function(F){return LO(F,{mode:"readwrite",
nN:!0},function(k){return r9A(k,"videoPlaybackPositionEntity")})},KO=function(F,k,z){return LO(F,{mode:"readonly",
nN:!0},function(x){return Jp(x,k,z)})},W_=function(F,k,z){return LO(F,{mode:"readonly",
nN:!0},function(x){return yh(x,k,z)})},ZVD=function(F,k){F=g.l(F.observers);
for(var z=F.next();!z.done;z=F.next())z=z.value,z(k)},OV7=function(){var F,k,z;
return g.O(function(x){if(x.Y==1)return g.lD(x,2),g.c(x,g.DZ(),4);if(x.Y!=2){F=x.L;if(!F||!g.ow()||typeof g.bD.BroadcastChannel==="undefined")return x.return();k=new tUY;return x.return(new MV(F,k))}z=g.rI(x);z instanceof Error&&g.JV(z);return x.return()})},FL=function(){VUA||(VUA=OV7());
return VUA},It$=function(F){var k;
F=(k=F.options)==null?void 0:k.persistenceOption;return F==="ENTITY_PERSISTENCE_OPTION_PERSIST"||F==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},HV7=function(F){var k;
return g.O(function(z){return z.Y==1?g.c(z,FL(),2):(k=z.L)?g.c(z,LO(k,"readwrite",function(x){for(var D={},e=g.l(F),C=e.next(),p={};!C.done;p={OT:void 0,lA:void 0},C=e.next())p.OT=C.value,p.OT.entityKey&&It$(p.OT)&&(p.lA=g.PB(p.OT.payload),C=void 0,p.OT.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(C=function(E){return function(){return gr(x,E.OT.payload[E.lA],E.lA)}}(p)),p.OT.type==="ENTITY_MUTATION_TYPE_DELETE"&&(C=function(E){return function(){return Yq(x,E.OT.entityKey)}}(p)),p.OT.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(C=function(E){return function(){return BQ$(x,E.OT.entityKey,E.OT.payload[E.lA],E.lA)}}(p)),C&&(D[p.OT.entityKey]=D[p.OT.entityKey]?D[p.OT.entityKey].then(C):C()));
return g.vA.all(Object.values(D))}),0):z.return()})},atC=function(F){var k;
return g.O(function(z){if(z.Y==1){k=F.mutations;if(!k||k.length<=0)return z.return();if(g.ok){var x={type:"ENTITY_LOADED"};k!==void 0&&(x.payload=k);g.ok.dispatch(x)}return g.c(z,HV7(k),2)}k.length=0;g.Tp(z)})},S0$=function(F){return F!==void 0},bV$=function(F){var k=g.tT();
k=Object.assign({},k);F=Object.assign({},F);for(var z in k)F[z]?(k[z]!==4&&(k[z]=F[z]),delete F[z]):k[z]!==2&&(k[z]=4);Object.assign(k,F);g.MGn(k);JSON.stringify(k);return k},dOn=function(F){var k,z;
return g.O(function(x){if(x.Y==1)return g.c(x,g.DZ(),2);if(x.Y!=3)return(k=x.L)?g.c(x,g.c3(k),3):x.return();z=x.L;return x.return(g.SB(z,["index","media","captions"],{mode:"readwrite",nN:!0},function(D){var e=IDBKeyRange.bound(F+"|",F+"~");D=[D.objectStore("index").delete(e),D.objectStore("media").delete(e),D.objectStore("captions").delete(e)];return g.vA.all(D).then(function(){})}))})},J9t=function(){var F,k;
return g.O(function(z){if(z.Y==1)return g.c(z,g.DZ(),2);if(z.Y!=3){F=z.L;if(!F)throw g.t6("rvdfd");return g.c(z,g.c3(F),3)}k=z.L;return z.return(g.SB(k,["index","media"],{mode:"readwrite",nN:!0},function(x){var D={};return g.Rw(x.objectStore("index"),{},function(e){var C=e.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),p=g.vA.resolve(void 0);if(C){var E=C[1];C=C[2];D[E]=D[E]||{};var X;D[E][C]=g.FE6((X=e.getValue())==null?void 0:X.fmts)}else p=e.delete().then(function(){});
return g.vA.all([g.g3(e),p]).then(function(q){return g.l(q).next().value})}).then(function(){for(var e={},C=g.l(Object.keys(D)),p=C.next();!p.done;p=C.next()){p=p.value;
var E=D[p].v;e[p]=D[p].a&&E?1:2}var X=bV$(e);return g.UgY(x.objectStore("media"),{},function(q){var N=q.cursor.key.match(g.xZR);N&&e[N[1]]||x.objectStore("media").delete(q.cursor.key);return g.mgx(q)}).then(function(){return X})})}))})},y9C=function(F,k){var z,x;
return g.O(function(D){if(D.Y==1)return g.c(D,g.DZ(),2);if(D.Y!=3){z=D.L;if(!z)throw g.t6("wct");return g.c(D,g.c3(z),3)}x=D.L;return g.c(D,g.SB(x,["captions"],{mode:"readwrite",nN:!0},function(e){var C=[];e=e.objectStore("captions");for(var p=0;p<k.length;p++){var E=g.bM(e,k[p],F+"|"+k[p].metadata.vss_id);C.push(E)}return g.vA.all(C)}),0)})},RiC=function(F){var k,z,x;
return g.O(function(D){if(D.Y==1)return k=IDBKeyRange.bound(F+"|",F+"~"),g.c(D,g.DZ(),2);if(D.Y!=3){z=D.L;if(!z)throw g.t6("gactfv");return g.c(D,g.c3(z),3)}x=D.L;return D.return(x.getAll("captions",k))})},gQ$=function(F){return g.O(function(k){g.v3(F,0);
return k.return(dOn(F))})},Y0C=function(F){return{context:g.i0(),
videoIds:F}},nQ$=function(F){return{context:g.i0(),
playlistIds:F}},MU$=function(F){return{context:g.i0(),
offlinePlaylistSyncChecks:F}},L8G=function(){this.Y=new Map},K8$=function(){ftl||(ftl=new L8G);
return ftl},W89=function(F,k){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:F},metadata:k,statusCode:void 0,csn:void 0,can:void 0}},Fbt=function(F,k,z){if(!z){var x=x===void 0?!1:x;
z=F.Y.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!z||x)z=g.vt(16),F.Y.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",z)}F={flowNonce:z,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:k.eventType};k.metadata&&(F.flowMetadata=k.metadata);k.statusCode!==void 0&&(F.flowEventStatus=k.statusCode);k.csn&&(F.csn=k.csn);k.can&&(F.can=k.can);g.NA("flowEvent",F,void 0)},kA9=function(F){var k,z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K,Q,R,Jn,s$,u7,Gp,kG,jC,w9,G,t,Z;
return g.O(function(V){if(V.Y==1)return g.c(V,LO(F,{mode:"readonly",nN:!0},function(H){return yh(H,"playbackData").then(function(kY){var iD=kY.map(function(jH){return jH.transfer}).filter(function(jH){return!!jH}),DM=kY.map(function(jH){return jH.offlineVideoPolicy}).filter(function(jH){return!!jH}),a=kY.filter(function(jH){return!!jH.key}).map(function(jH){return g.is(g.xW(jH.key).entityId,"downloadStatusEntity")});
iD=yh(H,"transfer",iD);DM=yh(H,"offlineVideoPolicy",DM);a=yh(H,"downloadStatusEntity",a);var QR=iD.then(function(jH){jH=jH.reduce(function(eH,P6){(P6==null?0:P6.offlineVideoStreams)&&eH.push.apply(eH,g.r(P6.offlineVideoStreams));return eH},[]).filter(function(eH){return!!eH});
return yh(H,"offlineVideoStreams",jH)});
return g.vA.all([iD,DM,QR,a]).then(function(jH){var eH=g.l(jH);jH=eH.next().value;var P6=eH.next().value;var fk=eH.next().value;eH=eH.next().value;return[kY,jH,P6,fk,eH]})})}),2);
if(V.Y!=3)return k=V.L,g.c(V,LO(F,{mode:"readonly",nN:!0},function(H){return yh(H,"mainDownloadsListEntity").then(function(kY){var iD,DM;return(DM=(iD=kY[0])==null?void 0:iD.downloads)!=null?DM:[]})}),3);
z=V.L;x=g.l(k);D=x.next().value;e=x.next().value;C=x.next().value;p=x.next().value;E=x.next().value;X=D;q=e;N=C;u=p;w=E;m={};h={};B={};U={};v={};P=[];I=g.l(q);for(d=I.next();!d.done;d=I.next())(W=d.value)&&(m[W.key]=W);M=g.l(N);for(xY=M.next();!xY.done;xY=M.next())($Y=xY.value)&&(h[$Y.key]=$Y);Fx=g.l(w);for(y=Fx.next();!y.done;y=Fx.next())(K=y.value)&&(B[K.key]=K);Q=g.l(u);for(R=Q.next();!R.done;R=Q.next())(Jn=R.value)&&(U[Jn.key]=Jn);s$=g.l(z);for(u7=s$.next();!u7.done;u7=s$.next())Gp=u7.value,kG=
void 0,v[(kG=Gp.videoItem)!=null?kG:""]=!0,Gp.videoItem&&(w9=jC=void 0,G=(w9=(jC=g.xW(Gp.videoItem))==null?void 0:jC.entityId)!=null?w9:"",P.push({externalVideoId:G}));t=X.filter(function(H){if(!H||!H.key||!H.offlineVideoPolicy)return!1;H=g.xW(H.key).entityId;H=g.is(H,"downloadStatusEntity");var kY;return!(H&&((kY=B[H])==null?void 0:kY.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Z=t.map(function(H){var kY=m[H.transfer],iD=[];if(kY==null?0:kY.offlineVideoStreams)for(var DM=g.l(kY.offlineVideoStreams),a=DM.next();!a.done;a=DM.next())(a=U[a.value])&&iD.push(a);DM=h[H.offlineVideoPolicy];a=v;var QR=H==null?void 0:H.playerResponseTimestamp,jH=g.xW(DM.key).entityId;H=g.is(jH,"mainVideoEntity");if(DM.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var eH="OFFLINE_VIDEO_STATE_DISABLED";DM.expirationTimestamp&&Number(DM.expirationTimestamp)<Date.now()/1E3&&(eH="OFFLINE_VIDEO_STATE_EXPIRED")}else if(DM.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")eH="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(kY==null?void 0:kY.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":eH="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":eH="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":eH="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":eH="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":eH="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":eH="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:eH="OFFLINE_VIDEO_STATE_UNKNOWN"}if(eH==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(kY==null?void 0:kY.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":eH="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":eH="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":eH=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}jH={id:jH,videoState:eH};if(kY==null?0:kY.cotn)jH.cotn=kY.cotn;if(kY==null?0:kY.maximumDownloadQuality)jH.selectedVideoQuality=kY==null?void 0:kY.maximumDownloadQuality;if(kY==null?0:kY.lastProgressTimeMs)jH.lastProgressTimeMs=kY.lastProgressTimeMs;QR&&(jH.playerResponseSavedTimeMs=String(Number(QR)*1E3));kY=String;QR=0;iD=g.l(iD);for(eH=iD.next();!eH.done;eH=iD.next())if(eH=eH.value,eH.streamsProgress){eH=g.l(eH.streamsProgress);for(var P6=eH.next();!P6.done;P6=
eH.next()){var fk=void 0;QR+=Number((fk=P6.value.numBytesDownloaded)!=null?fk:0)}}jH.downloadedBytes=kY(QR);jH.selectedOfflineMode=a[H]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";DM.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(jH.offlinePlaybackDisabledReason=DM.offlinePlaybackDisabledReason);return jH});
return V.return({offlineVideos:Z,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:P}}})})},omV=function(){this.locks=navigator.locks},z4$=function(){try{var F=g.yR("ytglobal.locks_");
if(F)return F;var k;if(k=navigator){var z=navigator;k="locks"in z&&!!z.locks}if(k)return g.bD.localStorage&&g.bD.localStorage.getItem("noop"),F=new omV,g.dI("ytglobal.locks_",F),F}catch(x){}},kv=function(){},xlV=function(){},iT7=function(F){if(F.includes(":"))throw Error("Invalid user cache name: "+F);
return F+":"+g.kK("CacheStorage get")},DlC=function(){return g.O(function(F){if(o8!==void 0)return F.return(o8);
o8=new Promise(function(k){var z;return g.O(function(x){switch(x.Y){case 1:return g.lD(x,2),g.c(x,zq.open("test-only"),4);case 4:return g.c(x,zq.delete("test-only"),5);case 5:g.sC(x,3);break;case 2:if(z=g.rI(x),z instanceof Error&&z.name==="SecurityError")return k(!1),x.return();case 3:k("caches"in window),g.Tp(x)}})});
return F.return(o8)})},jmY=function(){return g.O(function(F){if(F.Y==1)return g.c(F,DlC(),2);
if(!F.L)return F.return(void 0);$ln||($ln=new xlV);return F.return($ln)})},xv=function(F,k,z){g.yI(new g.Fa("Woffle: "+F,z?{cotn:z}:""));
k instanceof Error&&g.yI(k)},e4$=function(F){var k;
return g.O(function(z){if(z.Y==1)return g.c(z,kA9(F),2);k=z.L;g.NA("offlineStateSnapshot",k);g.Tp(z)})},iS=function(F){g.S.call(this);
var k=this;this.api=F;this.Pe={LtK:function(){return k.Y},
ygK:function(){return k.L}};
typeof g.bD.BroadcastChannel!=="undefined"&&(this.Y=new g.bD.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.kK()),this.Y.onmessage=this.U.bind(this),this.L=new g.bD.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.kK()),this.L.onmessage=this.j.bind(this))},Di=function(F,k){F.api.ZQ("onOfflineOperationFailure",k);
var z;(z=F.Y)==null||z.postMessage(k)},CRD=function(F,k,z,x){var D=this;
this.B=F;this.K=k;this.visibility=z;this.V=x;this.W=this.G=this.S=this.U=this.Y=!1;this.j=new g.KS(function(){D.WL()});
this.Pe={f9:function(){return D.L},
WL:function(){D.WL()},
Vq_:function(){return D.j}};
this.visibility.subscribe("visibilitystatechange",function(){D.FA()})},Ai9=function(F){if(!F.U&&!F.Y){var k=z4$();
if(k){F.U=!0;var z=g.kK("OfflineLockManager");k.request("woffle_orchestration_leader:"+z,{},function(){var x,D,e,C;return g.O(function(p){switch(p.Y){case 1:return g.lD(p,2),F.L=new g.Zd,F.Y=!0,F.U=!1,g.c(p,F.B(),4);case 4:return g.c(p,F.L.promise,5);case 5:g.sC(p,0);break;case 2:x=g.rI(p),((e=(D=F).V)==null?0:e.call(D,"wo_relinquish_leadership_on_lock_request_error"))||F.WL(),x instanceof Error&&(C=x,C.args=[{name:"WoLockManagerError",Np:x.name}],g.JV(C)),g.Tp(p)}})})}}},pK9=function(F){F.Y&&(F.W=
!0,$v(F))},Em7=function(F,k){F.Y&&(F.S=k,$v(F))},XKG=function(F,k){F.Y&&(F.G=k,$v(F))},$v=function(F){F.G&&F.S&&F.W&&F.visibility.isBackground()?g.WN(F.j,6E4):F.j.stop()},jO=function(F){var k;
F.offlineDeleteReason=(k=F.offlineDeleteReason)!=null?k:"OFFLINE_DELETE_REASON_UNKNOWN";var z;F.offlineModeType=(z=F.offlineModeType)!=null?z:"OFFLINE_NOW";g.NA("offlineDeleteEvent",F)},eO=function(F,k){var z=k.videoId;
var x=k.Tu;k=k.offlineModeType;F.encryptedVideoId=z;F.cotn=x==null?void 0:x.cotn;F.offlineabilityFormatType=x==null?void 0:x.maximumDownloadQuality;var D;F.isRefresh=(D=x==null?void 0:x.isRefresh)!=null?D:!1;var e;F.softErrorCount=(e=x==null?void 0:x.transferRetryCount)!=null?e:0;F.offlineModeType=k!=null?k:"OFFLINE_NOW";(F.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&F.statusType==="UNKNOWN_STATUS_TYPE"||!F.transferStatusType&&!F.statusType)&&g.yI(Error("Woffle unknown transfer status"));
g.NA("offlineTransferStatusChanged",F)},qg$=function(F,k,z,x){x={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!x};k&&z&&(k=Math.floor(k/1024).toFixed(),z=Math.floor(z/1024).toFixed(),x.alreadyDownloadedKbytes=k,x.totalFetchedKbytes=k,x.totalContentKbytes=z);eO(x,F)},NCC=function(F){eO({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},F)},uJ9=function(F){switch(F){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Cy=function(F){var k,z,x;
return((x=(k=F.actionMetadata)==null?void 0:(z=k.retryScheduleIntervalsInSeconds)==null?void 0:z.length)!=null?x:0)>0},AG=function(F){return F.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!F.entityKey},py=function(F){return F.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!F.entityKey},Eo=function(F){return F.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!F.entityKey},wKn=function(F){return F.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!F.entityKey},
XL=function(F,k,z,x,D){D=D===void 0?!1:D;
var e,C,p,E,X,q;return g.O(function(N){if(N.Y==1)return e=g.is(F,k),C=g.is(F,"downloadStatusEntity"),g.c(N,LO(z,{mode:"readonly",nN:!0},function(u){return g.vA.all([Jp(u,e,k),Jp(u,C,"downloadStatusEntity")])}),2);
p=N.L;E=p.length?p[0]:void 0;if(!E)return N.Sk(0);X=ml$;if(q=p.length>1?p[1]:void 0){if(q.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!D)return N.return();q.downloadState=x}else q={key:C,downloadState:x};g.ME(E,X,q);return g.c(N,LO(z,{mode:"readwrite",nN:!0},function(u){return g.vA.all([gr(u,E,k),gr(u,q,"downloadStatusEntity")])}),0)})},qP=function(F,k){return F.actionType===k.actionType&&F.entityKey===k.entityKey},NP=function(F,k){if(F&&F.transferState!=="TRANSFER_STATE_COMPLETE"&&F.transferState!==
"TRANSFER_STATE_FAILED"){var z=g.xW(F.key).entityId;
eO({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:z,Tu:F,offlineModeType:k})}},uS=function(F){if(!F||!F.thumbnails)return[];
var k=[];F=g.l(F.thumbnails);for(var z=F.next();!z.done;z=F.next())z=z.value,z.url&&k.push(z.url);return k},TC9=function(F,k,z){z=z===void 0?[]:z;
var x,D,e,C,p,E,X,q,N,u,w,m,h;return g.O(function(B){if(B.Y==1)return z.length?g.c(B,W_(F,k),2):B.return([]);x=B.L;D=new Set;e=g.l(x);for(C=e.next();!C.done;C=e.next())if(p=C.value,E=p.id||p.key)X=g.xW(E).entityId,D.add(X);q=[];N=g.l(z);for(u=N.next();!u.done;u=N.next())w=u.value,m=w.offlineVideoData,h=void 0,((h=m)==null?0:h.videoId)&&!D.has(m.videoId)&&q.push(w);return B.return(q)})},l5C=function(F,k,z){return new g.Rt(F,{cotn:k,
raw_player_response:z,download_media:!0,start:Infinity,disable_watch_next:!0})},QmV=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},wD=function(F,k,z,x,D,e,C,p,E,X,q){this.entityType=F;
this.actionId=k;this.action=z;this.parentActionId=x;this.rootActionId=D===void 0?k:D;this.childActionIds=e;this.prereqActionId=C;this.postreqActionIds=p;this.hasChildActionFailed=X;this.retryScheduleIndex=0;this.Y=q||Date.now();this.retryScheduleIndex=E||0},m7=function(F){if(!F.key)throw Error("Entity key is required.");
if(!F.actionProto)throw Error("OfflineOrchestrationAction is required.");var k=g.xW(F.key),z=g.xW(F.actionProto.entityKey);return new wD(z.entityType,k.entityId,F.actionProto,F.parentActionId,F.rootActionId,F.childActionIds,F.prereqActionId,F.postreqActionIds,F.retryScheduleIndex,F.hasChildActionFailed,Number(F.enqueueTimeSec)*1E3)},Tq=function(F){return{key:g.is(F.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:F.action,parentActionId:F.parentActionId,rootActionId:F.rootActionId,childActionIds:F.childActionIds,prereqActionId:F.prereqActionId,postreqActionIds:F.postreqActionIds,retryScheduleIndex:F.retryScheduleIndex,hasChildActionFailed:F.hasChildActionFailed,enqueueTimeSec:(F.Y/1E3).toFixed()}},h4n=function(){var F;
return g.O(function(k){return k.Y==1?g.c(k,jmY(),2):(F=k.L)?k.return(F.delete("yt-player-local-img")):k.return(!0)})},lS=function(F){var k,z;
return g.O(function(x){if(x.Y==1)return g.c(x,jmY(),2);if(x.Y!=3){k=x.L;if(!k)throw Error("Cache API not supported");return F.length?g.c(x,k.open("yt-player-local-img"),3):x.return()}z=x.L;return g.c(x,Promise.all(F.map(function(D){return z.delete(D)})),0)})},Q2=function(F){var k,z;
return g.O(function(x){if(x.Y==1)return g.c(x,jmY(),2);if(x.Y!=3){k=x.L;if(!k)throw Error("Cache API not supported");return F.length?g.c(x,k.open("yt-player-local-img"),3):x.return()}z=x.L;return g.c(x,z.addAll(F),0)})},hG=function(F,k,z,x,D){var e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K,Q,R,Jn,s$,u7,Gp,kG;
return g.O(function(jC){switch(jC.Y){case 1:return e=g.is(F,"mainVideoEntity"),C=g.is(F,"ytMainChannelEntity"),p=g.is(F,"transfer"),E=g.is(F,"videoDownloadContextEntity"),g.c(jC,LO(k,{mode:"readonly",nN:!0},function(w9){return g.vA.all([Jp(w9,e,"mainVideoEntity"),Jp(w9,C,"ytMainChannelEntity"),Jp(w9,p,"transfer"),Jp(w9,E,"videoDownloadContextEntity"),yh(w9,"ytMainChannelEntity"),yh(w9,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=jC.L;q=g.l(X);N=q.next().value;u=q.next().value;w=q.next().value;m=q.next().value;h=q.next().value;B=q.next().value;U=N;v=u;P=w;I=m;d=h;W=B;if(!U&&!v){jC.Sk(3);break}M=U?uS(U.thumbnail):[];if(!v){xY=[];jC.Sk(4);break}return g.c(jC,sm7(v,d),5);case 5:xY=jC.L;case 4:return $Y=xY,g.c(jC,lS(M.concat($Y)),3);case 3:Fx=[];y=g.is(F,"downloadStatusEntity");K=g.l(W);for(Q=K.next();!Q.done;Q=K.next())R=Q.value,Jn=g.xW(R.key).entityId,s$=m7(R),u7=g.xW(s$.action.entityKey).entityId,Jn!==F&&u7!==F||qP(z,
R.actionProto)||Fx.push(R.key);return g.c(jC,LO(k,{mode:"readwrite",nN:!0},function(w9){var G=Fx.map(function(t){return Yq(w9,t)});
G.push(Yq(w9,e,{sZ:!0}));G.push(Yq(w9,y,{sZ:!0}));return g.vA.all(G)}),7);
case 7:kG=(Gp=I)==null?void 0:Gp.offlineModeType,D&&(jO(D),D.offlineModeType&&(kG=D.offlineModeType)),NP(P,kG),Di(x,{entityKey:e,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Tp(jC)}})},GAA=function(F,k,z,x){var D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K,Q,R,Jn,s$,u7,Gp,kG,jC,w9,G,t,Z,V,H,kY,iD,DM,a,QR,jH,eH,P6,fk,b7,KC;
return g.O(function(YY){switch(YY.Y){case 1:return D=g.is(F,"mainPlaylistEntity"),e=g.is(F,"ytMainChannelEntity"),g.c(YY,LO(k,{mode:"readonly",nN:!0},function(n8){return g.vA.all([Jp(n8,D,"mainPlaylistEntity"),Jp(n8,e,"ytMainChannelEntity"),yh(n8,"mainPlaylistEntity"),yh(n8,"mainDownloadsListEntity"),yh(n8,"ytMainChannelEntity"),yh(n8,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:C=YY.L;p=g.l(C);E=p.next().value;X=p.next().value;q=p.next().value;N=p.next().value;u=p.next().value;w=p.next().value;m=E;h=X;B=q;U=N;v=u;P=w;if(!m&&!h){YY.Sk(3);break}I=m?rit(m):[];if(!h){d=[];YY.Sk(4);break}return g.c(YY,sm7(h,v),5);case 5:d=YY.L;case 4:return W=d,g.c(YY,lS(I.concat(W)),3);case 3:M=[];xY=new Map;if(!m){YY.Sk(7);break}return g.c(YY,BCH(m,B,U),8);case 8:M=YY.L;$Y=g.l(M);for(Fx=$Y.next();!Fx.done;Fx=$Y.next())y=Fx.value,xY.set(y,{videoId:y,playlistId:F,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.c(YY,LO(k,{mode:"readonly",nN:!0},function(n8){return g.vA.all([yh(n8,"transfer"),yh(n8,"videoDownloadContextEntity")])}),9);
case 9:K=YY.L;Q=g.l(K);R=Q.next().value;Jn=Q.next().value;s$=R;u7=Jn;Gp=g.l(s$);for(kG=Gp.next();!kG.done;kG=Gp.next())jC=kG.value,w9=g.xW(jC.key).entityId,(G=xY.get(w9))&&jC&&(G.cotn=jC.cotn);t=g.l(u7);for(Z=t.next();!Z.done;Z=t.next())V=Z.value,H=g.xW(V.key).entityId,(kY=xY.get(H))&&V&&(kY.offlineModeType=V.offlineModeType);case 7:iD=[];DM=g.l(P);for(a=DM.next();!a.done;a=DM.next())QR=a.value,jH=g.xW(QR.key).entityId,eH=m7(QR),jH!==F&&eH.rootActionId!==F||qP(z,QR.actionProto)||iD.push(QR.key);P6=
g.is(F,"mainPlaylistEntity");return g.c(YY,LO(k,{mode:"readwrite",nN:!0},function(n8){var bI=iD.map(function(N3){return Yq(n8,N3)});
bI.push(Yq(n8,P6,{sZ:!0}));return g.vA.all(bI)}),10);
case 10:if(!m){YY.Sk(0);break}M.reverse();if(!M){YY.Sk(0);break}fk=g.l(M);b7=fk.next();case 13:if(b7.done){YY.Sk(0);break}KC=b7.value;return g.c(YY,hG(KC,k,z,x,xY.get(KC)),14);case 14:b7=fk.next(),YY.Sk(13)}})},trp=function(F,k,z,x){var D,e,C,p,E,X,q,N,u;
return g.O(function(w){if(w.Y==1)return D=g.is("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),e=new Map,g.c(w,LO(F,{mode:"readwrite",nN:!0},function(m){var h=yh(m,"transfer"),B=yh(m,"offlineOrchestrationActionWrapperEntity"),U=yh(m,"videoDownloadContextEntity"),v=Jp(m,D,"mainDownloadsListEntity");return g.vA.all([h,B,U,v]).then(function(P){P=g.l(P);var I=P.next().value;var d=P.next().value;var W=P.next().value;var M=P.next().value;P=Ulp.map(function($Y){return r9A(m,$Y)});
d=g.l(d);for(var xY=d.next();!xY.done;xY=d.next())xY=xY.value,qP(k,xY.actionProto)||P.push(Yq(m,xY.key,{sZ:!0}));M&&(M.downloads=[],P.push(gr(m,M,"mainDownloadsListEntity")));if(W)for(W=g.l(W),M=W.next();!M.done;M=W.next())M=M.value,d=g.xW(M.key).entityId,d=g.is(d,"transfer"),e.set(d,M.offlineModeType);return g.vA.all(P).then(function(){return I})})}),2);
C=w.L;p=g.l(C);for(E=p.next();!E.done;E=p.next())X=E.value,NP(X,e.get(X.key)),q=g.xW(X.key).entityId,N={videoId:q,offlineDeleteReason:x,cotn:X.cotn,offlineModeType:e.get(X.key)},jO(N),u=g.is(q,"mainVideoEntity"),Di(z,{entityKey:u,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.c(w,h4n(),0)})},rit=function(F,k){var z=[];
if(F.thumbnailStyleData){F=g.l(F.thumbnailStyleData);for(var x=F.next();!x.done;x=F.next()){var D=void 0,e=void 0,C=void 0;z=z.concat(uS((D=x.value)==null?void 0:(e=D.value)==null?void 0:(C=e.collageThumbnail)==null?void 0:C.coverThumbnail))}}k=uS(k);return z.concat(k)},BCH=function(F,k,z){var x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y;
return g.O(function(Fx){x=[];D=new Set;if(z.length)for(e=g.l(z),C=e.next();!C.done;C=e.next())if(p=C.value,E=void 0,(E=p.downloads)==null?0:E.length)for(X=g.l(p.downloads),q=X.next();!q.done;q=X.next())N=q.value,N.videoItem&&(u=g.xW(N.videoItem).entityId,D.add(u));if(F.videos){w=g.l(F.videos);for(m=w.next();!m.done;m=w.next())h=m.value,B=JSON.parse(g.xW(h).entityId),B.videoId&&!D.has(B.videoId)&&x.push(B.videoId);U=g.l(k);for(v=U.next();!v.done;v=U.next())if(P=v.value,P.key!==F.key&&(I=P.videos))for(d=
g.l(I),W=d.next();!W.done;W=d.next())M=W.value,xY=JSON.parse(g.xW(M).entityId),xY.videoId&&($Y=x.indexOf(xY.videoId),$Y!==-1&&x.splice($Y,1))}return Fx.return(x)})},sm7=function(F,k){var z,x,D,e,C,p,E,X;
return g.O(function(q){z=uS(F.avatar);x=g.l(k);for(D=x.next();!D.done;D=x.next())if(e=D.value,e.id!==F.id)for(C=g.l(uS(e.avatar)),p=C.next();!p.done;p=C.next())E=p.value,X=z.indexOf(E),X!==-1&&z.splice(X,1);return q.return(z)})},ZTC=function(F){var k;
return g.O(function(z){k=g.J(F.frameworkUpdates,so);return F.frameworkUpdates&&k?g.c(z,atC(k),0):z.return()})},ciC=function(F){var k;
if((k=F.onResponseReceivedActions)!=null&&k.length){var z;F=(z=g.J(g.J(F.onResponseReceivedActions[0],vmD),g.grp))==null?void 0:z.actions;if(F!=null&&F.length)return F}},PRt=function(F){var k,z,x;
return g.O(function(D){if(D.Y==1)return F?g.c(D,KO(F,g.P$,"mainDownloadsListEntity"),2):D.return([]);k=D.L;return((z=k)==null?0:(x=z.downloads)==null?0:x.length)?D.return(k.downloads.map(function(e){var C;return(C=e.videoItem)!=null?C:""})):D.return([])})},VrA=function(F,k){var z;
return g.O(function(x){return x.Y==1?g.c(x,OTt(F,k),2):(z=x.L)?g.c(x,LO(F,{mode:"readwrite",nN:!0},function(D){var e=[gr(D,z.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];z.mainDownloadsListEntity&&e.push(gr(D,z.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.vA.all(e)}),0):x.Sk(0)})},OTt=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P;
return g.O(function(I){if(I.Y==1)return z=g.is("main_downloads_library_id","mainDownloadsLibraryEntity"),x=g.is("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.c(I,LO(F,{mode:"readonly",nN:!0},function(d){return g.vA.all([Jp(d,z,"mainDownloadsLibraryEntity"),Jp(d,x,"mainDownloadsListEntity")])}),2);
D=I.L;e=g.l(D);C=e.next().value;p=e.next().value;E=C;X=p;E||(E={id:z});q=g.l(k);for(N=q.next();!N.done;N=q.next())if(u=N.value,u===g.P$){if(E.smartDownloadsList)return I.return();E.smartDownloadsList=u}else if(w=g.xW(u).entityType,m={},w==="mainPlaylistEntity"?m.playlistItem=u:w==="mainVideoEntity"&&(m.videoItem=u),!g.SI(m)){h=void 0;if((h=X)==null?0:h.downloads){B=!1;U=g.l(X.downloads);for(v=U.next();!v.done;v=U.next())if(P=v.value,P.playlistItem===u||P.videoItem===u){B=!0;break}B||X.downloads.push(m)}else X=
{id:x,downloads:[m]};E.downloadsList=x}return I.return({mainDownloadsLibraryEntity:E,mainDownloadsListEntity:X})})},I5G=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B;
return g.O(function(U){if(U.Y==1)return z=g.is("main_downloads_library_id","mainDownloadsLibraryEntity"),x=g.is("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.c(U,LO(F,{mode:"readonly",nN:!0},function(v){return g.vA.all([Jp(v,z,"mainDownloadsLibraryEntity"),Jp(v,x,"mainDownloadsListEntity"),Jp(v,g.P$,"mainDownloadsListEntity")])}),2);
D=U.L;e=g.l(D);C=e.next().value;p=e.next().value;E=e.next().value;X=C;q=p;N=E;if(!X)return U.Sk(0);if(k===g.P$&&((u=N)==null?0:u.downloads))N.downloads=[];else if((w=q)==null?0:w.downloads)for(m=g.xW(k).entityType,h=0;h<q.downloads.length;h++)if(B=q.downloads[h],m==="mainVideoEntity"&&B.videoItem===k){q.downloads.splice(h,1);break}else if(m==="mainPlaylistEntity"&&B.playlistItem===k){q.downloads.splice(h,1);break}return g.c(U,LO(F,{mode:"readwrite",nN:!0},function(v){var P=[gr(v,X,"mainDownloadsLibraryEntity")];
q&&P.push(gr(v,q,"mainDownloadsListEntity"));N&&P.push(gr(v,N,"mainDownloadsListEntity"));return g.vA.all(P)}),0)})},rD=function(F,k){var z,x,D,e,C,p,E,X,q,N,u;
return g.O(function(w){if(w.Y==1)return z=g.is(k,"transfer"),x=g.is(k,"videoDownloadContextEntity"),g.c(w,LO(F,{mode:"readonly",nN:!0},function(m){return g.vA.all([Jp(m,z,"transfer"),Jp(m,x,"videoDownloadContextEntity")])}),2);
D=w.L;e=g.l(D);C=e.next().value;p=e.next().value;E=C;X=p;u={videoId:k,cotn:(q=E)==null?void 0:q.cotn,offlineModeType:(N=X)==null?void 0:N.offlineModeType};return w.return(u)})},Bd=function(F,k,z,x,D){var e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY;
return g.O(function($Y){switch($Y.Y){case 1:return e=g.is(F,"musicTrack"),C=g.is(F,"transfer"),g.c($Y,LO(k,{mode:"readonly",nN:!0},function(Fx){return g.vA.all([Jp(Fx,e,"musicTrack"),Jp(Fx,C,"transfer"),yh(Fx,"musicTrack"),yh(Fx,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:p=$Y.L;E=g.l(p);X=E.next().value;q=E.next().value;N=E.next().value;u=E.next().value;w=X;m=q;h=N;B=u;if(!w){$Y.Sk(3);break}return g.c($Y,HTl(w,h),4);case 4:return U=$Y.L,g.c($Y,lS(U),3);case 3:v=[];P=g.l(B);for(I=P.next();!I.done;I=P.next())d=I.value,W=g.xW(d.key).entityId,M=m7(d),xY=g.xW(M.action.entityKey).entityId,W!==F&&xY!==F||qP(z,d.actionProto)||v.push(d.key);return g.c($Y,LO(k,{mode:"readwrite",nN:!0},function(Fx){var y=v.map(function(K){return Yq(Fx,K)});
y.push(Yq(Fx,e,{sZ:!0}));return g.vA.all(y)}),6);
case 6:NP(m),D&&jO(D),Di(x,{entityKey:e,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Tp($Y)}})},Gq=function(F,k,z,x,D){var e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K,Q,R,Jn,s$,u7,Gp,kG,jC,w9,G,t,Z;
return g.O(function(V){switch(V.Y){case 1:return e=g.is(F,k),C=g.is("music_downloads_library_id","musicDownloadsLibraryEntity"),g.c(V,LO(z,{mode:"readonly",nN:!0},function(H){return g.vA.all([Jp(H,e,k),Jp(H,C,"musicDownloadsLibraryEntity"),yh(H,k),yh(H,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:p=V.L;E=g.l(p);X=E.next().value;q=E.next().value;N=E.next().value;u=E.next().value;w=X;m=q;h=N;B=u;if(!w){V.Sk(3);break}return g.c(V,HTl(w,h),4);case 4:return U=V.L,g.c(V,lS(U),3);case 3:v=[];P=new Map;if(!w){V.Sk(6);break}return g.c(V,a59(w,h,m),7);case 7:v=V.L;I=g.l(v);for(d=I.next();!d.done;d=I.next())W=d.value,M=g.xW(W).entityId,P.set(M,{videoId:M,playlistId:F,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.c(V,W_(z,"transfer"),8);case 8:for(xY=V.L,$Y=g.l(xY),
Fx=$Y.next();!Fx.done;Fx=$Y.next())y=Fx.value,K=g.xW(y.key).entityId,(Q=P.get(K))&&y&&(Q.cotn=y.cotn);case 6:R=[];Jn=g.l(B);for(s$=Jn.next();!s$.done;s$=Jn.next())u7=s$.value,Gp=g.xW(u7.key).entityId,kG=m7(u7),Gp!==F&&kG.rootActionId!==F||qP(x,u7.actionProto)||R.push(u7.key);jC=g.is(F,k);return g.c(V,LO(z,{mode:"readwrite",nN:!0},function(H){var kY=R.map(function(iD){return Yq(H,iD)});
kY.push(Yq(H,jC,{sZ:!0}));return g.vA.all(kY)}),9);
case 9:if(!w){V.Sk(0);break}v.reverse();if(!v.length){V.Sk(0);break}w9=g.l(v);G=w9.next();case 12:if(G.done){V.Sk(0);break}t=G.value;Z=g.xW(t).entityId;if(!Z){V.Sk(13);break}return g.c(V,Bd(Z,z,x,D,P.get(Z)),13);case 13:G=w9.next(),V.Sk(12)}})},Uo=function(F,k,z){var x,D,e,C,p,E,X;
return g.O(function(q){if(q.Y==1)return g.c(q,LO(F,{mode:"readwrite",nN:!0},function(N){var u=yh(N,"transfer"),w=yh(N,"offlineOrchestrationActionWrapperEntity");return g.vA.all([u,w]).then(function(m){m=g.l(m);var h=m.next().value;var B=m.next().value;m=SgG.map(function(I){return r9A(N,I)});
B=g.l(B);for(var U=B.next();!U.done;U=B.next()){U=U.value;var v=g.xW(U.actionProto.entityKey).entityType==="musicTrack",P=U.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";qP(k,U.actionProto)||v&&(!v||P)||m.push(Yq(N,U.key,{sZ:!0}))}return g.vA.all(m).then(function(){return h})})}),2);
x=q.L;D=g.l(x);for(e=D.next();!e.done;e=D.next())C=e.value,NP(C),p=g.xW(C.key).entityId,E={videoId:p,offlineDeleteReason:void 0,cotn:C.cotn},jO(E),X=g.is(p,"musicTrack"),Di(z,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.c(q,h4n(),0)})},bT$=function(F){for(var k,z=g.l(F.additionalMetadatas),x=z.next();!x.done;x=z.next())x=x.value,x.offlineMusicVideoData&&(k=x.offlineMusicVideoData);
var D,e,C,p,E;return{id:g.is(F.videoId,"musicTrack"),videoId:F.videoId,title:F.title,thumbnailDetails:F.thumbnail,lengthMs:String(Number(F.lengthSeconds)*1E3),albumTitle:(D=k)==null?void 0:D.releaseTitle,musicVideoType:(e=k)==null?void 0:e.musicVideoType,contentRating:{explicitType:(C=k)==null?void 0:C.explicitType},artistNames:((p=k)==null?void 0:p.byline)||((E=k)==null?void 0:E.channelName),downloadMetadata:g.is(F.videoId,"musicTrackDownloadMetadataEntity")}},a59=function(F,k,z){var x,D,e,C,p,E,
X,q,N,u,w,m,h,B,U,v,P,I;
return g.O(function(d){x=[];D=new Set;if((e=z)==null?0:(C=e.downloadedTracks)==null?0:C.length)for(p=g.l(z.downloadedTracks),E=p.next();!E.done;E=p.next())X=E.value,D.add(X);if(F.tracks){q=g.l(F.tracks);for(N=q.next();!N.done;N=q.next())u=N.value,D.has(u)||x.push(u);w=g.l(k);for(m=w.next();!m.done;m=w.next())if(h=m.value,h.id!==F.id&&(B=h.tracks))for(U=g.l(B),v=U.next();!v.done;v=U.next())P=v.value,I=x.indexOf(P),I!==-1&&x.splice(I,1)}return d.return(x)})},HTl=function(F,k){var z,x,D,e,C,p,E,X;
return g.O(function(q){z=uS(F.thumbnailDetails);x=g.l(k);for(D=x.next();!D.done;D=x.next())if(e=D.value,e.id!==F.id)for(C=g.l(uS(e.thumbnailDetails)),p=C.next();!p.done;p=C.next())E=p.value,X=z.indexOf(E),X!==-1&&z.splice(X,1);return q.return(z)})},dll=function(F,k){var z,x,D,e,C,p,E,X,q;
return g.O(function(N){if(N.Y==1)return z=g.is("music_downloads_library_id","musicDownloadsLibraryEntity"),g.c(N,KO(F,z,"musicDownloadsLibraryEntity"),2);(x=N.L)||(x={id:z});D=g.xW(k).entityType;D==="musicTrack"?(e=x.downloadedTracks)!=null&&e.includes(k)||(x.downloadedTracks=((C=x.downloadedTracks)!=null?C:[]).concat(k)):D==="musicPlaylist"?(p=x.downloadedPlaylists)!=null&&p.includes(k)||(x.downloadedPlaylists=((E=x.downloadedPlaylists)!=null?E:[]).concat(k)):D!=="musicAlbumRelease"||(X=x.downloadedAlbumReleases)!=
null&&X.includes(k)||(x.downloadedAlbumReleases=((q=x.downloadedAlbumReleases)!=null?q:[]).concat(k));return g.c(N,fO(F,x,"musicDownloadsLibraryEntity"),0)})},Jil=function(F,k){var z,x,D,e,C,p,E;
return g.O(function(X){if(X.Y==1)return z=g.is("music_downloads_library_id","musicDownloadsLibraryEntity"),g.c(X,KO(F,z,"musicDownloadsLibraryEntity"),2);x=X.L;if(!x)return X.Sk(0);D=g.xW(k).entityType;D==="musicTrack"?e=x.downloadedTracks:D==="musicPlaylist"&&(e=x.downloadedPlaylists);if((C=e)==null?0:C.length)for(p=0;p<e.length;p++)if(E=e[p],E===k){e.splice(p,1);break}return g.c(X,fO(F,x,"musicDownloadsLibraryEntity"),0)})},yiC=function(F){var k=F.videos;
F=[];var z=[];if(k){k=g.l(k);for(var x=k.next();!x.done;x=k.next()){var D=x.value.offlineVideoData.videoId;x=g.is(D,"musicTrack");D=g.is(D,"musicTrackDownloadMetadataEntity");F.push(x);z.push(D)}}return{hN:F,jo:z}},tG=function(F,k,z){k={track:bT$(k)};
z&&(k.playlistId=z);if(F=g.J(F.actionMetadata,R4$))k.maximumDownloadQuality=F.maximumDownloadQuality;return{musicTrackEntityActionMetadata:k}},Ygn=function(F){var k,z,x,D,e,C,p,E;
return g.O(function(X){switch(X.Y){case 1:return k=g.EP(),z=Y0C(F),x=g.jn(gmG),g.lD(X,2),e={XJ:!0},g.c(X,g.od(k,z,x,void 0,e),4);case 4:D=X.L;g.sC(X,3);break;case 2:C=g.rI(X);if(C instanceof g.C1)throw p="GetOffline network manager error: "+C.message,xv(p,C),Error(p);xv("GetOffline fetch request error",C);throw Error("GetOffline fetch request error");case 3:E=Zi(D);if(!D)throw xv("Network request failed"),Error("Network request failed");if(E!==void 0)vd(E);else if(!D.videos||!D.videos.length)throw xv("No data"),
Error("No data");return X.return(D.videos.map(function(q){return q.offlineVideoData}))}})},nmY=function(F){var k,z,x,D,e,C,p,E;
return g.O(function(X){switch(X.Y){case 1:return k=g.EP(),z=nQ$(F),x=g.jn(gmG),g.lD(X,2),e={XJ:!0},g.c(X,g.od(k,z,x,void 0,e),4);case 4:D=X.L;g.sC(X,3);break;case 2:C=g.rI(X);if(C instanceof g.C1)throw p="GetOffline network manager error for playlist: "+C.message,xv(p,C),Error(p);xv("GetOffline fetch request error for playlist",C);throw Error("GetOffline fetch request error for playlist");case 3:E=Zi(D);if(!D)throw xv("Network request failed for playlist"),Error("Network request failed for playlist");
if(E!==void 0)vd(E,"playlist");else if(!D.playlists||!D.playlists.length)throw xv("No data for playlist"),Error("No data for playlist");return X.return(D.playlists.map(function(q){return q.offlinePlaylistData}))}})},Lb$=function(F,k,z,x){var D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K,Q,R,Jn,s$,u7;
return g.O(function(Gp){switch(Gp.Y){case 1:return g.c(Gp,FL(),2);case 2:D=Gp.L;if(!D)return Gp.return([]);e=[];if((C=x)==null?0:C.length){e=x;Gp.Sk(3);break}return g.c(Gp,W_(D,"mainPlaylistEntity"),4);case 4:e=Gp.L;case 3:if(!e.length)return Gp.return([]);p=[];E=Date.now()/1E3;X=g.l(e);q=X.next();case 5:if(q.done)return p.length?g.c(Gp,Mr$(p),10):Gp.return([]);N=q.value;if(!N.downloadState){u=void 0;Gp.Sk(8);break}return g.c(Gp,KO(D,N.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:u=
Gp.L;case 8:w=u;m=void 0;B=(h=(m=N)==null?void 0:m.entityMetadata)&&h.nextAutoRefreshIntervalSeconds?Number(h.nextAutoRefreshIntervalSeconds):NaN;U=Number.isNaN(B)?F:B;P=v=void 0;I=((v=w)==null?0:v.lastSyncedTimestampMillis)?Number((P=w)==null?void 0:P.lastSyncedTimestampMillis)/1E3:0;W=d=void 0;M=((d=w)==null?0:d.addedTimestampMillis)?Number((W=w)==null?void 0:W.addedTimestampMillis)/1E3:0;if(z||!h||I+U<=E){xY=[];$Y=void 0;if(($Y=N.videos)==null?0:$Y.length)for(Fx=g.l(N.videos),y=Fx.next();!y.done;y=
Fx.next())K=y.value,Q=JSON.parse(g.xW(K).entityId),Q.videoId&&xY.push(Q.videoId);R="0";h&&(Jn=void 0,R=String(Number((Jn=h.offlineLastModifiedTimestampSeconds)!=null?Jn:0).toFixed()));s$={playlistId:N.playlistId,videoIds:xY,offlineLastModifiedTimestamp:R,autoSync:k,offlineDateAddedTimestamp:String(M.toFixed())};p.push(s$)}q=X.next();Gp.Sk(5);break;case 10:return u7=Gp.L,Gp.return(u7)}})},f57=function(){var F,k,z,x,D;
return g.O(function(e){if(e.Y==1)return g.c(e,FL(),2);if(e.Y!=3)return(F=e.L)?g.c(e,W_(F,"refresh"),3):e.return(!1);k=e.L;if((z=k[0])==null||!z.refreshTime)return e.return(!1);x=Number(k[0].refreshTime);D=Date.now()/1E3;return e.return(isFinite(x)&&D>=x)})},WbV=function(F,k){var z,x,D;
return g.O(function(e){switch(e.Y){case 1:return g.lD(e,2),g.c(e,Kb$(F,k),4);case 4:return x=e.L,g.c(e,ZTC(x),5);case 5:z=ciC(x);g.sC(e,3);break;case 2:D=g.rI(e),xv("getAndProcessSmartDownloadsResponse request or processing error",D);case 3:return e.return(z)}})},F6Y=function(F,k,z,x){var D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K,Q,R,Jn,s$,u7;
return g.O(function(Gp){switch(Gp.Y){case 1:return g.c(Gp,FL(),2);case 2:D=Gp.L;if(!D)return Gp.return([]);e=[];if((C=x)==null?0:C.length){e=x;Gp.Sk(3);break}return g.c(Gp,W_(D,"musicPlaylist"),4);case 4:e=Gp.L;case 3:if(!e.length)return Gp.return([]);p=[];E=Date.now()/1E3;X=g.l(e);q=X.next();case 5:if(q.done)return p.length?g.c(Gp,Mr$(p),10):Gp.return([]);N=q.value;u=void 0;m=(w=(u=N)==null?void 0:u.entityMetadata)&&w.nextAutoRefreshIntervalSeconds?Number(w.nextAutoRefreshIntervalSeconds):NaN;h=
Number.isNaN(m)?F:m;U=B=0;v="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!N.downloadMetadata){Gp.Sk(8);break}return g.c(Gp,KO(D,N.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:P=Gp.L,d=I=void 0,B=Number((d=(I=P)==null?void 0:I.addedTimestampMillis)!=null?d:"0")/1E3,M=W=void 0,U=Number((M=(W=P)==null?void 0:W.lastModifiedTimestampMillis)!=null?M:"0")/1E3,$Y=xY=void 0,v=($Y=(xY=P)==null?void 0:xY.syncState)!=null?$Y:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Fx=void 0;if(z||v!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!w||Number((Fx=w.lastSyncedTimestampSeconds)!=null?Fx:0)+h<=E){y=[];K=void 0;if((K=N.tracks)==null?0:K.length)for(Q=g.l(N.tracks),R=Q.next();!R.done;R=Q.next())Jn=R.value,y.push(g.xW(Jn).entityId);s$={playlistId:N.playlistId,videoIds:y,offlineLastModifiedTimestamp:String(U.toFixed()),autoSync:k,offlineDateAddedTimestamp:String(B.toFixed())};p.push(s$)}q=X.next();Gp.Sk(5);break;case 10:return u7=Gp.L,Gp.return(u7)}})},Kb$=function(F,k){var z,x,D,e,C,p,E,X,q,N;
return g.O(function(u){switch(u.Y){case 1:return z=g.EP(),g.c(u,FL(),2);case 2:x=u.L;if(!x){u.Sk(3);break}return g.c(u,kA9(x),4);case 4:D=u.L;case 3:var w=D;e={context:g.i0(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:F},offlineClientState:w,clientStateRequestData:{preferredFormatType:k}}}};C=g.jn(krl);g.lD(u,5);E={XJ:!0};return g.c(u,g.od(z,e,C,void 0,E),7);case 7:p=u.L;g.sC(u,6);break;case 5:X=g.rI(u);if(X instanceof g.C1)throw q=
"DPS network manager error for smart downloads: "+X.message,xv(q,X),Error(q);xv("DPS fetch request error for smart downloads",X);throw Error("DPS fetch request error for smart downloads");case 6:N=Zi(p);if(p)N!==void 0&&vd(N,"smart downloads");else throw xv("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return u.return(p)}})},zTn=function(F,k){var z,x,D,e,C,p,E,X;
return g.O(function(q){switch(q.Y){case 1:return z=g.EP(),x={context:g.i0(),videoPlaybackPositionEntities:F,lastSyncTimestampUsec:k},D=g.jn(o2n),g.lD(q,2),C={XJ:!0},g.c(q,g.od(z,x,D,void 0,C),4);case 4:e=q.L;g.sC(q,3);break;case 2:p=g.rI(q);if(p instanceof g.C1)throw E="VPPS network manager error: "+p.message,xv(E,p),Error(E);xv("VPPS fetch request error",p);throw Error("VPPS fetch request error");case 3:X=Zi(e);if(e)X!==void 0&&vd(X,"position sync");else throw xv("Network request failed for position sync"),
Error("Network request failed for position sync");return q.return(e)}})},iSD=function(F,k,z){var x,D,e,C,p,E,X,q;
return g.O(function(N){switch(N.Y){case 1:x=g.EP();var u=z.refreshData,w=z.isEnqueuedForExpiredStreamUrlRefetch,m=z.HH,h=z.offlineSourceData,B=z.mediaCapabilities,U={entityKey:F};u&&(U.refreshData=u);w&&(U.isExpiredStreamUrlRefetch=w);m&&(U.downloadParameters=m);h&&(U.offlineSourceData=h);u={context:g.jx(k),signatureTimestamp:20181,videos:[U]};B&&(u.mediaCapabilities=B);D=u;e=g.jn(xdY);g.lD(N,2);p={XJ:!0};return g.c(N,g.od(x,D,e,void 0,p),4);case 4:C=N.L;g.sC(N,3);break;case 2:E=g.rI(N);if(E instanceof
g.C1)throw X="GetPDE network manager error: "+E.message,xv(X,E),Error(X);xv("GetPDE fetch request error",E);throw Error("GetPDE fetch request error");case 3:q=Zi(C);if(C)q!==void 0&&vd(q,"PDE");else throw xv("Network request failed for PDE"),Error("Network request failed for PDE");return N.return(C)}})},Zi=function(F){var k;
return(k=F.errorMetadata)==null?void 0:k.status},vd=function(F,k){k=k?" for "+k:"";
if(F===0)throw F="Empty response body"+k,xv(F),Error(F);F="Response with error"+k;xv(F);throw Error(F);},Mr$=function(F){var k,z,x,D,e,C,p,E;
return g.O(function(X){switch(X.Y){case 1:return k=g.EP(),z=MU$(F),x=g.jn(DdA),g.lD(X,2),e={XJ:!0},g.c(X,g.od(k,z,x,void 0,e),4);case 4:D=X.L;g.sC(X,3);break;case 2:C=g.rI(X);if(C instanceof g.C1)throw p="offlinePlaylistSyncCheck network manager error: "+C.message,xv(p,C),Error(p);xv("offlinePlaylistSyncCheck fetch request error",C);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:E=Zi(D);if(!D)throw xv("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(E!==void 0)vd(E,"playlist sync");else if(!D.offlinePlaylistSyncCheckDatas||!D.offlinePlaylistSyncCheckDatas.length)throw xv("No data for playlist sync"),Error("No data for playlist sync");return X.return(D.offlinePlaylistSyncCheckDatas.map(function(q){return q.offlinePlaylistSyncCheckData}))}})},cd=function(F){this.Y=F},$dG=function(F,k){var z,x,D,e,C,p;
return g.O(function(E){switch(E.Y){case 1:z=new Map,x=g.l(k),D=x.next();case 2:if(D.done){E.Sk(4);break}e=D.value;C=z;p=C.set;return g.c(E,F.L(e),5);case 5:p.call(C,e,E.L);D=x.next();E.Sk(2);break;case 4:return E.return(z)}})},Pd=function(F,k,z,x,D,e){k=g.is(k,z);
x=Object.assign({},e,{priority:x,retryScheduleIntervalsInSeconds:D});return{actionType:F,entityKey:k,actionMetadata:x}},Oo=function(F,k,z,x,D,e){this.status=F;
this.Y=k;this.j=z;this.L=x;this.U=D;this.downloadState=e},jCY=function(F,k,z){this.Y=F;
this.YG=k;this.U=z},ACC=function(F,k){var z,x,D,e,C,p,E,X,q;
return g.O(function(N){switch(N.Y){case 1:return z=k.entityKey,D=(x=g.J(k.actionMetadata,V2))==null?void 0:x.isEnqueuedForExpiredStreamUrlRefetch,g.lD(N,2),e=void 0,g.c(N,eTY(F,k),4);case 4:e=N.L;g.lD(N,5);var u=(u=g.J(k.actionMetadata,V2))?{maximumDownloadQuality:u.maximumDownloadQuality}:void 0;return g.c(N,iSD(z,F.YG,{isEnqueuedForExpiredStreamUrlRefetch:D,HH:u,offlineSourceData:e}),7);case 7:C=N.L;g.sC(N,6,2);break;case 5:return g.rI(N,2),p=Cy(k)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",xv("PDE handleAdd error"),N.return(I8(k,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",p,"DOWNLOAD_STATE_FAILED"));case 6:return g.c(N,CVl(F,C,k),8);case 8:return N.return(I8(k,!0,C.orchestrationActions));case 2:return E=g.rI(N),X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.h6&&E.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),xv("PDE handleAdd error"),N.return(I8(k,!1,void 0,X,q,"DOWNLOAD_STATE_FAILED"))}})},XND=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y;
return g.O(function(Fx){switch(Fx.Y){case 1:return z=k.entityKey,x=g.xW(z).entityId,g.c(Fx,LO(F.Y,{mode:"readonly",nN:!0},function(y){var K=Jp(y,z,"playbackData"),Q=Jp(y,g.is(x,"offlineVideoPolicy"),"offlineVideoPolicy");y=Jp(y,g.is(x,"transfer"),"transfer");return g.vA.all([K,Q,y])}),2);
case 2:D=Fx.L;e=g.l(D);C=e.next().value;p=e.next().value;E=e.next().value;X=C;q=p;N=E;if(!X||!q)return Fx.return(I8(k,!0));u=[];h=((m=X)==null?0:m.playerResponseJson)?JSON.parse(X.playerResponseJson):null;if(!(N&&h&&F.YG.V("html5_refresh_deprecated_downloads"))){Fx.Sk(3);break}w=pNC(F,h,N);return g.c(Fx,E2C(F,N),4);case 4:u=Fx.L;case 3:B={lastPlayerResponseTimestampSeconds:X.playerResponseTimestamp,offlineToken:q.offlineToken,formatIds:u};U={};if((v=N)==null?0:v.maximumDownloadQuality)U.maximumDownloadQuality=
N.maximumDownloadQuality;g.lD(Fx,5);P=void 0;return g.c(Fx,eTY(F,k),7);case 7:return P=Fx.L,g.lD(Fx,8),g.c(Fx,iSD(z,F.YG,{refreshData:B,HH:U,offlineSourceData:P,mediaCapabilities:w}),10);case 10:I=Fx.L;g.sC(Fx,9,5);break;case 8:return g.rI(Fx,5),d=Cy(k)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",xv("PDE handleRefresh error"),Fx.return(I8(k,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",d,
"DOWNLOAD_STATE_FAILED"));case 9:return g.c(Fx,CVl(F,I,k),11);case 11:return Fx.return(I8(k,!0,I.orchestrationActions));case 5:return W=g.rI(Fx),M="PDE handleRefresh error",W instanceof Error&&(M="PDE handleRefresh error: "+W.message),xY="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",$Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.h6&&W.type==="QUOTA_EXCEEDED"&&(xY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",$Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
xv(M),Fx.return(I8(k,!1,void 0,xY,$Y,"DOWNLOAD_STATE_FAILED"))}})},eTY=function(F,k){var z,x,D,e;
return g.O(function(C){if(C.Y==1)return z=g.xW(k.entityKey).entityId,x=g.is(z,"videoDownloadContextEntity"),g.c(C,KO(F.Y,x,"videoDownloadContextEntity"),2);D=C.L;return(e=D)!=null&&e.offlineModeType?C.return({offlineModeType:D.offlineModeType}):C.return(void 0)})},CVl=function(F,k,z){var x,D,e,C,p;
return g.O(function(E){if(E.Y==1){if(!k.frameworkUpdates||!g.J(k.frameworkUpdates,so))return E.return();if(!(g.J(k.frameworkUpdates,so).mutations&&g.J(k.frameworkUpdates,so).mutations.length>0&&g.J(k.frameworkUpdates,so).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return E.Sk(2);x=g.xW(g.J(k.frameworkUpdates,so).mutations[0].entityKey).entityId;return g.c(E,rD(F.Y,x),3)}if(E.Y!=2){D=E.L;e=g.J(z.actionMetadata,V2);if(p=(C=e)==null?void 0:C.playlistId)D.playlistId=p;D.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.f_(F.YG)?g.c(E,hG(x,F.Y,z,F.U,D),2):g.g8(F.YG)?g.c(E,Bd(x,F.Y,z,F.U),2):E.Sk(2)}return g.c(E,atC(g.J(k.frameworkUpdates,so)),0)})},I8=function(F,k,z,x,D,e){return new Oo(k?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Cy(F),z,x,D,e)},pNC=function(F,k,z){k=l5C(F.YG,z.cotn,k);
z=g.jk(k);return g.aN6(k,z,F.YG)},E2C=function(F,k){var z,x,D,e,C,p,E,X,q,N,u;
return g.O(function(w){if(w.Y==1)return z=[],g.c(w,LO(F.Y,{mode:"readonly",nN:!0},function(m){var h=[],B=k.offlineVideoStreams;if(B){B=g.l(B);for(var U=B.next();!U.done;U=B.next())h.push(Jp(m,U.value,"offlineVideoStreams"))}return g.vA.all(h)}),2);
if(x=w.L)for(D=g.l(x),e=D.next();!e.done;e=D.next())if(C=e.value,p=void 0,(p=C)==null?0:p.streamsProgress)for(E=C.streamsProgress,X=0;X<E.length;X++)q=E[X],N=JSON.parse(q.formatStreamBytes),u={itag:N.itag,lmt:N.lastModified,xtags:N.xtags},z.push(u);return w.return(z)})},qXA=function(F,k){this.Y=F;
this.YG=k},NYG=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w;
return g.O(function(m){switch(m.Y){case 1:return z=Cy(k),g.c(m,W_(F.Y,"videoPlaybackPositionEntity"),2);case 2:x=m.L;if(x.length===0)return m.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));g.lD(m,3);return g.c(m,SV.getInstance(),5);case 5:D=m.L;if(!D)throw Error("prefStorage is undefined");return g.c(m,D.get("psi"),6);case 6:return e=m.L,E=(p=(C=e)==null?void 0:C.au)!=null?p:"0",g.c(m,zTn(x,E),7);case 7:return X=m.L,q={isPaused:X.watchHistoryPaused,au:X.syncTimestampUsec},g.c(m,D.set("psi",
q),8);case 8:if(q.isPaused){m.Sk(9);break}N=g.J(X.frameworkUpdates,so);if(!X.frameworkUpdates||!N){m.Sk(9);break}return g.c(m,atC(N),9);case 9:g.sC(m,4);break;case 3:return u=g.rI(m),w="PPE handleRefresh error: "+(u instanceof Error?u.message:"unknown error"),xv(w),m.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return m.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
z))}})},wNG=function(F,k){var z,x,D,e,C,p,E,X;
return g.O(function(q){switch(q.Y){case 1:return z=Cy(k),x=g.xW(k.entityKey).entityId,g.lD(q,2),g.c(q,SV.getInstance(),4);case 4:D=q.L;if(!D)throw Error("prefStorage is undefined");return g.c(q,D.get("psi"),5);case 5:e=q.L;C=g.J(k.actionMetadata,uR9);if(((p=e)==null?void 0:p.isPaused)!==!1||(E=C)==null||!E.lastPlaybackPositionSeconds){q.Sk(6);break}X={key:g.is(x,"videoPlaybackPositionEntity"),videoId:x,lastPlaybackPositionSeconds:C.lastPlaybackPositionSeconds};return g.c(q,fO(F.Y,X,"videoPlaybackPositionEntity"),
6);case 6:g.sC(q,3);break;case 2:return g.rI(q),q.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z))}})},md$=function(F,k){var z,x,D;
return g.O(function(e){switch(e.Y){case 1:z=Cy(k);g.lD(e,2);x=g.xW(k.entityKey).entityId;if(x==="!*$_ALL_ENTITIES_!*$")return g.c(e,PUD(F.Y),5);D=g.is(x,"videoPlaybackPositionEntity");return g.c(e,c9V(F.Y,D),5);case 5:g.sC(e,3);break;case 2:return g.rI(e),e.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
z))}})},TYD=function(F,k){this.api=F;
this.Y=k;this.logger=new g.C4("woffle");this.L=!1;this.Pe={f2:this.f2};this.logger.debug("Initialized OfflineMediaManager")},lv$=function(F){return g.O(function(k){return k.return(gQ$(F))})},QC$=function(F){var k;
return g.O(function(z){if(z.Y==1)return g.c(z,g.kJ9(F),2);k=z.L;return z.return(k.filter(function(x){return!!x.url}).map(function(x){return x.url}))})},Hd=function(F,k){var z=g.ZL(k);
if(z===1||z===0)return Promise.resolve();(z=hTA(F,k))&&z.stopVideo();F.U=0;return lv$(k)},a8=function(F,k,z,x){z=z===void 0?!1:z;
x=x===void 0?!0:x;var D=typeof k==="string"?k:k.videoDetails.videoId;g.ZL(D)===2&&((k=hTA(F,D))?k.stopVideo():F.logger.info(function(){return"Corresponding player for "+D+" not found. Pausing anyway"}),g.v3(D,2),F.U=2,z?sCY(F.Y):x&&rCA(F.Y))},hTA=function(F,k){var z;
return((z=F.player)==null?void 0:z.getVideoData().videoId)===k?F.player:null},BY$=function(F,k,z){k.getPlayerResponse();
g.v3(k.videoId,2);F.U=2;F.L=!1;var x;(x=F.player)==null||x.dispose();F.player=F.api.xO(k);k={};F.player.Ij((k.localmediachange=F.bb,k.signatureexpired=F.Q5,k.statechange=F.Vrp,k),F);var D=F.f2(z);F.player.Zu(g.pt(D,D,!0,"m"),!1);F.logger.debug(function(){return"Starting headless playback with quality: "+D});
F.player.cn(!1)},GrH=function(F,k){this.Y=F;
this.YG=k},tuH=function(F,k){var z,x;
return g.O(function(D){switch(D.Y){case 1:return z=Cy(k),g.c(D,KO(F.Y,k.entityKey,"transfer"),2);case 2:if(x=D.L)return D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));g.lD(D,3);return g.c(D,Udp(F,k),5);case 5:g.sC(D,4);break;case 3:return g.rI(D),D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
z))}})},ZSt=function(F,k){var z,x;
return g.O(function(D){switch(D.Y){case 1:return z=Cy(k),g.c(D,KO(F.Y,k.entityKey,"transfer"),2);case 2:x=D.L;if(!x||x.transferState!=="TRANSFER_STATE_COMPLETE")return D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));g.lD(D,3);return g.c(D,Udp(F,k,!0),5);case 5:g.sC(D,4);break;case 3:return g.rI(D),D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z))}})},v2p=function(F,k){var z,x,D,e,C,p,E,X,q,N;
return g.O(function(u){switch(u.Y){case 1:return z=Cy(k),x=g.xW(k.entityKey).entityId,g.c(u,LO(F.Y,{mode:"readonly",nN:!0},function(w){var m=Jp(w,k.entityKey,"transfer");w=Jp(w,g.is(x,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.vA.all([m,w])}),2);
case 2:D=u.L;e=g.l(D);C=e.next().value;p=e.next().value;E=C;X=p;if(!E||E.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return u.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));g.lD(u,3);E.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.c(u,fO(F.Y,E,"transfer"),5);case 5:q=g.xW(E.key).entityId;eO({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:q,Tu:E,offlineModeType:(N=X)==null?void 0:N.offlineModeType});g.sC(u,
4);break;case 3:return g.rI(u),u.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return u.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z))}})},Udp=function(F,k,z){z=z===void 0?!1:z;
var x,D,e,C,p,E,X,q,N,u,w,m,h,B,U;return g.O(function(v){switch(v.Y){case 1:return x=g.J(k.actionMetadata,cCA),D=g.xW(k.entityKey).entityId,e=g.is(D,"downloadStatusEntity"),g.c(v,LO(F.Y,{mode:"readonly",nN:!0},function(P){var I=Jp(P,e,"downloadStatusEntity");P=Jp(P,g.is(D,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.vA.all([I,P])}),2);
case 2:return C=v.L,p=g.l(C),E=p.next().value,X=p.next().value,q=E,N=X,u="TRANSFER_STATE_TRANSFER_IN_QUEUE",((w=q)==null?void 0:w.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(u="TRANSFER_STATE_PAUSED_BY_USER"),B={key:k.entityKey,transferState:u,cotn:g.vt(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(m=x)==null?void 0:m.maximumDownloadQuality,preferredAudioTrack:(h=x)==null?void 0:h.preferredAudioTrack,transferRetryCount:0,isRefresh:z,hasLoggedFirstStarted:!1},g.c(v,LO(F.Y,
{mode:"readwrite",nN:!0},function(P){var I=[];z&&I.push(Yq(P,g.is(D,"offlineVideoStreams")));I.push(gr(P,B,"transfer"));return g.vA.all(I)}),3);
case 3:if(!z){v.Sk(4);break}return g.c(v,lv$(D),4);case 4:eO({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:D,Tu:B,offlineModeType:(U=N)==null?void 0:U.offlineModeType}),g.Tp(v)}})},OS$=function(F,k,z,x){if(!F.action.entityKey)throw Error("entityKey is missing.");
var D=g.xW(F.action.entityKey);D={entityType:D.UY,entityId:D.entityId,offlineOrchestrationActionType:F.action.actionType,orchestrationAction:{orchestrationActionId:F.actionId}};k&&(D.offlineOrchestrationActionResult=k.status,D.isRetryable=z?!1:k.Y,k.U&&(D.offlineOrchestrationFailureReason=PV$(k.U,D.isRetryable)));var e,C;if((e=F.action.actionMetadata)==null?0:(C=e.offlineLoggingData)==null?0:C.offlineModeType)D.offlineModeType=F.action.actionMetadata.offlineLoggingData.offlineModeType;x&&(D.additionalOrchestrationActions=
x.map(function(p){return{orchestrationActionId:p.actionId}}));
return D},PV$=function(F,k){return F!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||k?F==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&k?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":F:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},Vut=function(F,k){var z={offlineOrchestrationContext:OS$(F)};
k=W89(k,z);Fbt(K8$(),k,F.rootActionId)},IvY=function(F,k,z,x){x=x===void 0?[]:x;
k={offlineOrchestrationContext:OS$(F,k,z,x)};k=W89(3,k);Fbt(K8$(),k,F.rootActionId)},HSp=function(){this.actions=[]},avl=function(F,k){k=g.l(k);
for(var z=k.next();!z.done;z=k.next())z=z.value,Vut(z,1),F.actions.push(z);F.actions.sort(F.Y)},SX$=function(F,k){if(k)for(var z=0;z<F.actions.length;z++)if(k==="!*$_ALL_ENTITIES_!*$"&&F.actions[z].actionId!==k||k!=="!*$_ALL_ENTITIES_!*$"&&F.actions[z].rootActionId===k&&F.actions[z].actionId!==k)F.actions.splice(z,1),z--},bSA=function(F,k){F=g.l(F.actions);
for(var z=F.next();!z.done;z=F.next())if(z.value.actionId===k)return!0;return!1},SO=function(F,k,z,x,D){g.S.call(this);
var e=this;this.L=F;this.t4=k;this.Qh=z;this.G=x;this.YG=D;this.Y=new HSp;this.S=new g.oj;this.U=new g.KS(function(){e.retry()});
this.B=NaN;this.W=!1;this.Pe={nrU:function(){return e.Y},
wU:function(){return e.S},
JgK:function(){return e.U},
retry:function(){return e.retry()}};
g.b(this,this.U);this.K=this.L.observe(this.PR.bind(this))},yCY=function(F,k,z,x,D){var e;
return g.O(function(C){if(C.Y==1)return e=new SO(F,k,z,x,D),g.c(C,ddA(e),2);JCY(e);return C.return(e)})},JCY=function(F){var k=F.Y.actions[0];
return F.j?((k==null?void 0:k.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&F.j[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(F.W=!0),Promise.resolve()):RTY(F)},RTY=function(F){var k,z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U;
return g.O(function(v){switch(v.Y){case 1:if(F.j)throw Error("Already processing an action");if(F.z4())return v.return();k=F.Y.actions.shift();Em7(F.Qh,!k);if(k===void 0)return v.return();k.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&k.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&SX$(F.Y,k.actionId);z="";k.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&k.rootActionId===k.actionId&&(z=k.actionId);x=[k];F.j=x;if(D=F.t4[k.entityType]){v.Sk(2);break}F.j=
void 0;return g.c(v,RTY(F),3);case 3:return v.return();case 2:e=g.l(x);for(C=e.next();!C.done;C=e.next())p=C.value,Vut(p,2);g.lD(v,4,5);return g.c(v,$dG(D,x.map(function(P){return P.action})),7);
case 7:E=v.L,X=g.l(x),q=X.next();case 8:if(q.done){v.Sk(10);break}N=q.value;u=E.get(N.action);return g.c(v,g2n(F,N,u),9);case 9:q=X.next();v.Sk(8);break;case 10:SX$(F.Y,z);case 5:g.B6(v);F.j=void 0;g.UC(v,6);break;case 4:return w=g.rI(v),xv("Orchestration error",w),g.lD(v,12),g.c(v,YXV(F,x),14);case 14:g.sC(v,5);break;case 12:m=g.rI(v);xv("Orchestration retry error",m);h=g.l(x);for(B=h.next();!B.done;B=h.next())U=B.value,U.retryScheduleIndex<3&&avl(F.Y,[U]);v.Sk(5);break;case 6:return g.c(v,RTY(F),
0)}})},g2n=function(F,k,z){var x,D,e,C,p,E,X,q,N,u,w,m;
return g.O(function(h){switch(h.Y){case 1:x=k.retryScheduleIndex+2===3;if(z.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){h.Sk(2);break}if(z.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){h.Sk(0);break}IvY(k,z,x);if(z.Y&&k.retryScheduleIndex+1<3)return g.c(h,YXV(F,[k]),0);e=((D=z)==null?0:D.L)?z.L:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";C={entityKey:k.action.entityKey,failureReason:e};p=void 0;g.f_(F.YG)?p="mainVideoDownloadStateEntity":g.g8(F.YG)&&(p="musicTrackDownloadMetadataEntity");
if(!p||!z.downloadState){h.Sk(7);break}E=g.xW(k.action.entityKey).entityId;return g.c(h,XL(E,p,F.L,z.downloadState),7);case 7:Di(F.G,C);if(z.downloadState==="DOWNLOAD_STATE_FAILED"&&F.YG.V("html5_auto_retry_failed_pde_actions")){h.Sk(0);break}xv("Orchestration result is not retryable, deleting action");return g.c(h,c9V(F.L,Tq(k).key),0);case 2:X=void 0;try{X=(q=z.j)==null?void 0:q.map(function(B){return F.createAction(B,k)})}catch(B){return IvY(k,z,x),N={entityKey:k.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Di(F.G,N),xv("Orchestration subactions creation error",B),h.return()}IvY(k,z,x,X);if(!X){h.Sk(12);break}u=X.map(function(B){return Tq(B)});
w=0;case 13:if(!(w<X.length)||F.W){h.Sk(15);break}return g.c(h,LO(F.L,{mode:"readwrite",nN:!0},function(B){var U=[];U.push(QYV(B,u.slice(w,w+10),"offlineOrchestrationActionWrapperEntity"));return g.vA.all(U)}),16);
case 16:w+=10;h.Sk(13);break;case 15:if(F.W)return F.W=!1,h.return();case 12:return m=Tq(k),g.c(h,c9V(F.L,m.key),17);case 17:Vut(k,4),g.Tp(h)}})},fvD=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w;
return g.O(function(m){z=[];x=Infinity;D=4E3;e=g.l(k);for(C=e.next();!C.done;C=e.next())p=C.value,E=Number(p.enqueueTimeSec),X=n2$(E),q=p.retryScheduleIndex,N=q!=null&&q>0,X>0&&N?(x=Math.min(x,E),D=Math.min(X,D)):z.push(p);isFinite(x)&&(!F.U.isActive()||x<F.B)&&(F.B=x,F.U.start(D));F.S.bG()||(u=z.length,z=z.filter(function(h){var B;h=((B=h.actionProto)==null?void 0:B.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Mup.includes(h)}),w=z.length<u,!F.U.isActive()&&w&&F.U.start(1));
z.length>0&&L6V(F,z);return g.c(m,JCY(F),0)})},W6C=function(F){var k,z,x,D,e,C,p;
return g.O(function(E){if(E.Y==1)return g.c(E,K6Y(F),2);k=E.L;z=[];x=g.l(k);for(D=x.next();!D.done;D=x.next())e=D.value,C=g.xW(e.key),p=C.entityId,bSA(F.Y,p)||z.push(e);return g.c(E,fvD(F,z),0)})},n2$=function(F){F=F*1E3-Date.now();
return F>4E3?4E3:F},YXV=function(F,k){var z,x,D;
return g.O(function(e){z=g.l(k);for(x=z.next();!x.done;x=z.next()){D=x.value;var C=void 0,p=void 0,E=((p=D.action)==null?void 0:(C=p.actionMetadata)==null?void 0:C.retryScheduleIntervalsInSeconds)||[1,2,4];C=1;D.retryScheduleIndex<E.length&&(C=E[D.retryScheduleIndex]);D.Y=C*1E3+Date.now();D.retryScheduleIndex++}return g.c(e,FC$(F,k),0)})},ddA=function(F){var k;
return g.O(function(z){if(z.Y==1)return g.c(z,W_(F.L,"offlineOrchestrationActionWrapperEntity"),2);k=z.L;return g.c(z,fvD(F,k),0)})},L6V=function(F,k){k.length!==0&&k.forEach(function(z){z=m7(z);
z.retryScheduleIndex<3&&avl(F.Y,[z])})},K6Y=function(F,k){var z;
return g.O(function(x){if(x.Y==1)return g.c(x,W_(F.L,"offlineOrchestrationActionWrapperEntity",k),2);z=x.L;return x.return(z.filter(S0$))})},FC$=function(F,k){if(k.length===0)return Promise.resolve([]);
k=k.map(function(z){return Tq(z)});
return vQp(F.L,k)},klt=function(F){this.Vh=F;
this.Y=void 0},oeC=function(F,k){var z,x,D,e;
return g.O(function(C){z=k.videoId;x=!0;if(k.captionTracks.length)D=wD$(k),F.Y=new g.up(F.Vh,k,D);else if(k.H8)e=g.Cqx(k),F.Y=new g.mV(F.Vh,k.H8,z,e,k.NZ,k.eventId),x=k.NZ;else return C.return();return C.return(new Promise(function(p){var E;(E=F.Y)==null||E.F2({C$:function(){return g.O(function(X){if(X.Y==1)return g.c(X,F.C$(z,x),2);p();g.Tp(X)})},
jC:function(){}})}))})},z6$=function(F){var k;
return g.O(function(z){if(z.Y==1)return g.c(z,RiC(F),2);k=z.L;return z.return(!!k&&k.length>0)})},bS=function(F){g.S.call(this);
this.Y=F;this.L=this.Y.observe(this.U.bind(this))},xgl=function(F,k){var z,x,D,e,C,p,E;
return g.O(function(X){switch(X.Y){case 1:if(k.length===0)return X.return([]);z=k.map(function(q){return g.is(q,"transfer")});
return g.c(X,W_(F.Y,"transfer",z),2);case 2:x=X.L;D=x.filter(S0$).map(function(q){return g.xW(q.key).entityId});
e=k.filter(function(q){return D.indexOf(q)===-1});
if(e.length===0)return X.return([]);C=g.l(e);p=C.next();case 3:if(p.done){X.Sk(5);break}E=p.value;return g.c(X,lv$(E),4);case 4:p=C.next();X.Sk(3);break;case 5:return X.return(e)}})},$gp=function(F,k,z,x,D,e){var C,p,E;
return g.O(function(X){C="STREAM_TYPE_UNKNOWN";z.video&&z.audio?(C="STREAM_TYPE_AUDIO_AND_VIDEO",xv("unexpected stream type")):z.video&&!z.audio?C="STREAM_TYPE_VIDEO":!z.video&&z.audio&&(C="STREAM_TYPE_AUDIO");p=g.is(k,"offlineVideoStreams");E={numBytesDownloaded:D.toFixed(),numTotalBytes:e.toFixed(),streamType:C,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(x),itag:C==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(z.itag):void 0};return g.c(X,LO(F,{mode:"readwrite",nN:!0},
function(q){var N=Jp(q,p,"offlineVideoStreams"),u=Jp(q,g.is(k,"transfer"),"transfer");return g.vA.all([N,u]).then(function(w){w=g.l(w);var m=w.next().value;w=w.next().value;if(!w)return Yq(q,p).then(function(){});
var h=i6Y(m);m=Dgp(m,x,E,p);var B=gr(q,m,"offlineVideoStreams");i6Y(m)>h&&(w.lastProgressTimeMs=Date.now().toString());h=[B];w.offlineVideoStreams||(w.offlineVideoStreams=[]);w.offlineVideoStreams.indexOf(p)===-1&&(w.offlineVideoStreams.push(p),h.push(gr(q,w,"transfer")));return g.vA.all(h)})}),0)})},jRl=function(F,k){var z,x,D,e,C;
return g.O(function(p){if(p.Y==1)return z=g.is(k,"offlineVideoStreams"),g.c(p,KO(F,z,"offlineVideoStreams"),2);x=p.L;if(!x||!x.streamsProgress)return p.return();D=g.l(x.streamsProgress);for(e=D.next();!e.done;e=D.next())C=e.value,C.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",C.numTotalBytes!==C.numBytesDownloaded&&(C.numBytesDownloaded=C.numTotalBytes);return g.c(p,fO(F,x,"offlineVideoStreams"),0)})},Dgp=function(F,k,z,x){if(F&&F.streamsProgress){x=F;
a:{k=k.itag+";"+k.xtags;for(var D=F.streamsProgress,e=0;e<D.length;e++){var C=JSON.parse(D[e].formatStreamBytes);if(C.itag+";"+C.xtags===k){D[e]=z;z=D;break a}}D.push(z);z=D}x.streamsProgress=z}else F={key:x,streamsProgress:[z]};return F},i6Y=function(F){if(F==null?0:F.streamsProgress){var k=0;
F=F.streamsProgress;for(var z=0;z<F.length;z++){var x=F[z];isNaN(Number(x.numBytesDownloaded))?xv("stream progress bytes number invalid"):k+=Number(x.numBytesDownloaded)}return k}return 0},e6$=function(F,k,z,x){g.S.call(this);
var D=this;this.L=F;this.api=k;this.J4=z;this.PR=x;this.S=new g.oj;this.j=new g.KS(function(){D.Y&&D.Y.transferState==="TRANSFER_STATE_TRANSFERRING"&&D.S.bG()&&((D.Y.transferRetryCount||0)<3?a8(D.G,D.W,!1,!1):Hd(D.G,D.W.videoDetails.videoId),D.Hv("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Qh=this.Xf=0;this.K=this.B=!1;this.RU=g.lw(this.api.C().experiments,"html5_transfer_processing_logs_interval");this.l$=new g.yQ(this);this.Pe={uJt:function(){return D.j},
e2$:function(){return D.PR},
wU:function(){return D.S}};
this.t4=this.L.observe(this.ir.bind(this));this.G=new TYD(k,this);this.u$=new klt(k);this.mp=new bS(this.L);this.cR=this.S.listen("publicytnetworkstatus-online",this.Jt.bind(this));this.yh=this.S.listen("publicytnetworkstatus-offline",this.LEt.bind(this));this.K=this.api.C().V("html5_less_transfer_processing_logs");g.b(this,this.l$);this.l$.N(k,"offlinetransferpause",this.U0R);g.f_(this.api.C())?this.U="mainVideoDownloadStateEntity":g.g8(this.api.C())&&(this.U="musicTrackDownloadMetadataEntity")},
CT$=function(F){return g.O(function(k){if(k.Y==1)k=g.c(k,J9t(),2);
else{var z=F.mp;var x=g.tT();x=Object.keys(x);z=xgl(z,x);k=g.c(k,z,0)}return k})},JG=function(F,k){k=k===void 0?!1:k;
var z;return g.O(function(x){if(x.Y==1){if(F.Y)throw Error("Already downloading a video");F.Qh=0;F.B=!1;return g.c(x,AFl(F),2)}return x.Y!=4?(z=x.L,XKG(F.J4,!z),z&&F.S.bG()?k?g.c(x,new Promise(function(D){g.mz(D,1E3)}),4):x.Sk(4):(!z&&F.Y&&dD(F),x.Sk(0))):g.c(x,pjl(F,z),0)})},EeD=function(F){return g.O(function(k){if(k.Y==1)return F.W?g.c(k,Hd(F.G,F.W.videoDetails.videoId),3):k.Sk(0);
dD(F);g.Tp(k)})},Xj7=function(F,k){var z,x,D;
return g.O(function(e){switch(e.Y){case 1:return g.lD(e,2),(z=!!k.captionTracks.length||!!k.H8)?g.c(e,z6$(k.videoId),4):e.return();case 4:return(x=e.L)?e.return():g.c(e,oeC(F.u$,k),5);case 5:g.sC(e,0);break;case 2:D=g.rI(e),xv("Caption downloading error",D,k.cotn),g.Tp(e)}})},pjl=function(F,k){var z,x,D,e,C,p;
return g.O(function(E){switch(E.Y){case 1:if(F.B)return E.return();F.B=!0;F.Y=k;z=g.xW(F.Y.key);x=z.entityId;D=void 0;if(F.Y.transferState==="TRANSFER_STATE_TRANSFERRING")return g.c(E,y2(F,x),7);if(F.Y.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||F.Y.transferRetryCount||F.Y.hasLoggedFirstStarted){E.Sk(3);break}return g.c(E,y2(F,x),5);case 5:return D=E.L,F.Y.hasLoggedFirstStarted=!0,g.c(E,qWC(F),6);case 6:qg$({videoId:x,Tu:F.Y,offlineModeType:D},void 0,void 0,!0);E.Sk(3);break;case 7:D=E.L,
eO({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:x,Tu:F.Y,offlineModeType:D});case 3:return g.c(E,N6$(F),8);case 8:return e=null,g.lD(E,9),g.c(E,uFG(F,k),11);case 11:e=E.L;F.W=e;g.sC(E,10);break;case 9:return C=g.rI(E),xv("error getting player response",C,k.cotn),g.c(E,F.Hv("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return E.return();case 10:return p=l5C(F.api.C(),k.cotn,e),g.c(E,Xj7(F,p),13);case 13:return g.c(E,QC$(p.videoId),
14);case 14:p.Yg=E.L,BY$(F.G,p,k.maximumDownloadQuality),F.j.start(108E5),g.Tp(E)}})},AFl=function(F){var k,z;
return g.O(function(x){if(x.Y==1)return g.c(x,W_(F.L,"transfer"),2);k=x.L;z=k.filter(wjV).sort(mgY);return z.length===0?x.return():x.return(z[0])})},N6$=function(F){var k,z,x;
return g.O(function(D){if(D.Y==1){if(!F.Y)return R8(F,"onTransferStart"),D.return();F.j.start(108E5);return g.c(D,gD(F,"TRANSFER_STATE_TRANSFERRING"),2)}k=F.Y;return(x=((z=k)==null?0:z.key)?g.xW(k.key).entityId:"")&&F.U?g.c(D,XL(x,F.U,F.L,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):D.Sk(0)})},sCY=function(F){var k,z,x,D;
g.O(function(e){switch(e.Y){case 1:if(!F.Y){R8(F,"onTransferPausedByUser");e.Sk(2);break}k=F.Y;F.j.stop();return g.c(e,gD(F,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:x=((z=k)==null?0:z.key)?g.xW(k.key).entityId:"";if(!x||!F.U){e.Sk(4);break}return g.c(e,XL(x,F.U,F.L,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.c(e,y2(F,x),6);case 6:D=e.L,NCC({videoId:x,Tu:k,offlineModeType:D});case 2:dD(F),JG(F),g.Tp(e)}})},rCA=function(F){var k,z,x;
g.O(function(D){if(D.Y==1){if(!F.Y)return R8(F,"onTransferPausedByNetwork"),D.return();F.j.stop();return g.c(D,gD(F,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(D.Y!=3)return k=F.Y,(x=((z=k)==null?0:z.key)?g.xW(k.key).entityId:"")&&F.U?g.c(D,XL(x,F.U,F.L,"DOWNLOAD_STATE_PAUSED"),3):D.Sk(3);dD(F);g.Tp(D)})},T6H=function(F){var k,z,x,D,e;
g.O(function(C){switch(C.Y){case 1:if(!F.Y)return R8(F,"onTransferComplete"),C.return();k=F.Y;F.j.stop();if(!k||!F.W){C.Sk(2);break}z=l5C(F.api.C(),k.cotn,F.W);return g.c(C,Xj7(F,z),2);case 2:return g.c(C,gD(F,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:D=((x=k)==null?0:x.key)?g.xW(k.key).entityId:"";if(!D||!F.U){C.Sk(5);break}return g.c(C,XL(D,F.U,F.L,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.c(C,jRl(F.L,D),7);case 7:return g.c(C,y2(F,D),8);case 8:e=C.L,eO({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:D,Tu:k,offlineModeType:e}),dD(F),JG(F),g.Tp(C)}})},leA=function(F,k,z){var x,D;
g.O(function(e){switch(e.Y){case 1:if(!F.Y)return R8(F,"onTransferProgress: "+k),e.return();if(F.Y.transferState==="TRANSFER_STATE_TRANSFERRING"){e.Sk(2);break}return g.c(e,N6$(F),2);case 2:x=Date.now();if(!(x-F.Xf>1E3)){e.Sk(4);break}F.Xf=x;return g.c(e,$gp(F.L,z.videoId,z.L,z.W2,z.bytesDownloaded,z.Y),5);case 5:if(F.K&&!(F.K&&x-F.Qh>F.RU)){e.Sk(4);break}F.Qh=x;return g.c(e,y2(F,k),7);case 7:D=e.L,qg$({videoId:k,Tu:F.Y,offlineModeType:D},z.bytesDownloaded,z.Y);case 4:F.j.start(108E5),g.Tp(e)}})},
QRV=function(F){var k=(F.Y.transferRetryCount||0)<3;
k&&(F=F.Y,F.transferRetryCount=(F.transferRetryCount||0)+1);return k},h67=function(F,k){k=k===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":k;
var z,x,D,e;return g.O(function(C){if(C.Y==1)return F.Y||R8(F,"setTransferToFailed: "+k),z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k==="TRANSFER_FAILURE_REASON_NETWORK"?z="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":k==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.c(C,gD(F,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",k),2);if(C.Y!=3)return Di(F.PR,{entityKey:(x=F.Y)==null?void 0:x.key,failureReason:z}),
D=F.Y?g.xW(F.Y.key).entityId:"",g.c(C,y2(F,D),3);e=C.L;var p={videoId:D,Tu:F.Y,offlineModeType:e},E=k,X={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};E&&(X.transferFailureReason=E,X.failureReason=uJ9(E));eO(X,p);g.Tp(C)})},gD=function(F,k,z,x){var D;
return g.O(function(e){if(e.Y==1){if(!F.Y)return R8(F,"saveTransferState: "+k),e.return();F.Y.transferState=k;F.Y.failureReason=x;g.lD(e,2);return g.c(e,qWC(F,function(C){return z?yh(C,"offlineVideoStreams",F.Y.offlineVideoStreams).then(function(p){for(var E=g.l(p),X=E.next();!X.done;X=E.next())if((X=X.value)&&X.streamsProgress){X=g.l(X.streamsProgress);for(var q=X.next();!q.done;q=X.next())q.value.streamState=z}return QYV(C,p.filter(function(N){return!!N}),"offlineVideoStreams")}):g.vA.resolve(void 0)}),
4)}if(e.Y!=2)return g.sC(e,0);
D=g.rI(e);return D instanceof g.h6&&D.type==="QUOTA_EXCEEDED"?g.c(e,F.Hv("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):e.Sk(0)})},qWC=function(F,k){var z;
return g.O(function(x){if(!F.Y)return x.return();z=F.Y;return g.c(x,LO(F.L,{mode:"readwrite",nN:!0},function(D){var e=[gr(D,z,"transfer")];k&&e.push(k(D));return g.vA.all(e)}),0)})},dD=function(F){F.Y=void 0;
F.W=void 0;F.j.stop()},uFG=function(F,k){var z,x,D,e,C;
return g.O(function(p){if(p.Y==1)return z=g.xW(k.key),x=z.entityId,D=g.is(x,"playbackData"),g.c(p,KO(F.L,D,"playbackData"),2);e=p.L;if((C=e)==null?0:C.playerResponseJson)return p.return(JSON.parse(e.playerResponseJson));throw Error("No PlayerResponse found");})},R8=function(F,k){F.api.UK("woffle",{mcte:k});
xv("missing current transfer entity.")},y2=function(F,k){var z,x,D;
return g.O(function(e){if(e.Y==1)return g.c(e,KO(F.L,g.is(k,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);z=e.L;return e.return((D=(x=z)==null?void 0:x.offlineModeType)!=null?D:void 0)})},wjV=function(F){return sRC[F.transferState]!==void 0},mgY=function(F,k){var z=sRC[F.transferState],x=sRC[k.transferState];
return z!==x?z-x:Number(F.enqueuedTimestampMs)-Number(k.enqueuedTimestampMs)},Yv=function(F,k){var z=this;
this.YG=F;this.api=k;this.S=new g.oj;this.W=new g.Zd;this.Pe={f9:function(){return z.U.Pe.f9()},
wU:function(){return z.S},
Wtt:function(){return z.U},
Mg:function(){return z.Mg()},
OP:function(){return z.OP()},
dN:function(){return z.dN()},
XR:function(){return z.XR()},
iQ:function(){return z.iQ()},
j8:function(x){return z.j8(x)}};
this.U=new CRD(function(){return rFC(z)},function(){z.dN()},this.api.qB(),this.api.V.bind(this.api));
this.Y=new iS(this.api);Ai9(this.U)},rFC=function(F){return g.O(function(k){F.api.ZQ("onOrchestrationBecameLeader");
return g.c(k,F.OP(),0)})},GlC=function(F){var k,z;
return g.O(function(x){if(x.Y==1)return g.c(x,FL(),2);if(x.Y!=3){k=x.L;if(!k)return xv("PES is undefined"),x.return();F.L=new e6$(k,F.api,F.U,F.Y);z=F.t8(k);return g.c(x,yCY(k,z,F.U,F.Y,F.YG),3)}F.G=x.L;return g.c(x,B6Y(F),0)})},B6Y=function(F){var k;
return g.O(function(z){switch(z.Y){case 1:if(!F.L)return xv("transferManager is undefined"),z.return();if(F.L.Y){z.Sk(2);break}return g.c(z,JG(F.L),2);case 2:if(!F.YG.V("woffle_enable_main_downloads_library")){z.Sk(4);break}return g.c(z,F.Df(),4);case 4:if(!F.YG.V("html5_offline_playback_position_sync")){z.Sk(6);break}return g.c(z,F.jY(),7);case 7:return g.c(z,F.j8(864E5),6);case 6:return g.c(z,F.refreshAllStaleEntities(43200,!0),9);case 9:return g.c(z,F.y4(),10);case 10:if(!F.YG.V("html5_retry_downloads_for_expiration")){z.Sk(11);
break}return g.c(z,F.iQ(),11);case 11:return F.B=g.TE(function(){F.refreshAllStaleEntities(43200,!0);F.y4()},9E5),g.iM(g.$K(),function(){return F.XR()}),g.c(z,FL(),13);
case 13:return k=z.L,g.c(z,e4$(k),14);case 14:pK9(F.U),g.Tp(z)}})},UgG=function(){var F,k,z,x,D,e;
return g.O(function(C){switch(C.Y){case 1:return g.c(C,FL(),2);case 2:F=C.L;if(!F)return C.return([]);k=Date.now()/1E3;return g.c(C,W_(F,"offlineVideoPolicy"),3);case 3:z=C.L,x=g.l(z),D=x.next();case 4:if(D.done){C.Sk(6);break}e=D.value;if(!(e.expirationTimestamp&&Number(e.expirationTimestamp)<k)){C.Sk(5);break}e.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";e.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.c(C,fO(F,e,"offlineVideoPolicy"),5);
case 5:D=x.next();C.Sk(4);break;case 6:return C.return(z.map(function(p){return p.key}))}})},ny=function(F,k,z,x,D){var e,C,p;
return g.O(function(E){if(E.Y==1)return g.c(E,FL(),2);e=E.L;if(!e)return E.return([]);C=k.map(function(X){var q=g.is(X,z);q={actionType:x,entityKey:q,actionMetadata:Object.assign({},QmV(),D)};x!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(q.actionMetadata.priority=0);X=new wD(z,X,q);return Tq(X)});
p=vQp(e,C);Ai9(F.U);return E.return(p)})},tdn=function(F,k,z,x){var D,e,C,p,E,X,q,N;
return g.O(function(u){switch(u.Y){case 1:D=[],e=g.l(k),C=e.next();case 2:if(C.done){u.Sk(4);break}p=C.value;if(p.upToDate||z&&!p.shouldAutoSyncMetadata||!p.playlistId){u.Sk(3);break}E={};switch(x){case "mainPlaylistEntity":X={nextAutoRefreshIntervalSeconds:p.checkInSeconds,autoSync:z};E={mainPlaylistEntityActionMetadata:X};break;case "musicPlaylist":q={autoSync:z},E={musicPlaylistEntityActionMetadata:q}}return g.c(u,ny(F,[p.playlistId],x,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",E),6);case 6:(N=
u.L)&&D.push.apply(D,g.r(N));case 3:C=e.next();u.Sk(2);break;case 4:return u.return(D)}})},Z6n=function(F,k){var z;
return g.O(function(x){return k.length?(z=QmV(),g.ME(z,V2,{isEnqueuedForExpiredStreamUrlRefetch:!0}),F.api.UK("qrd",{v:k.length}),x.return(ny(F,k,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",z))):x.return([])})},ve$=function(F,k,z){this.Y=F;
this.YG=k;this.U=z},O67=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v;
return g.O(function(P){switch(P.Y){case 1:return z=Cy(k),x=g.xW(k.entityKey),D=x.entityId,e=[],g.lD(P,2),g.c(P,cFl(F,D),4);case 4:e=P.L;if(!(F.YG.V("woffle_enable_main_downloads_library")&&((C=e)==null?0:C.length))){P.Sk(5);break}return g.c(P,VrA(F.Y,[k.entityKey]),5);case 5:g.sC(P,3);break;case 2:return p=g.rI(P),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.h6&&p.type==="QUOTA_EXCEEDED"?(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):xv("Playlist add error"),P.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,E,X));case 3:q=[];if(!F.YG.V("html5_offline_prevent_redownload_downloaded_video")){P.Sk(7);break}return g.c(P,TC9(F.Y,"mainVideoEntity",e),8);case 8:e=P.L;case 7:if((N=e)==null?0:N.length)for(u=g.l(e),w=u.next();!w.done;w=u.next())if(m=w.value,h=m.offlineVideoData,B=void 0,(B=h)==null?0:B.videoId)U=void 0,v=Number(((U=k.actionMetadata)==null?void 0:U.priority)||
0)+1,q.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h.videoId,"mainVideoEntity",v,MP,PT7(k,h,D)));return P.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,q))}})},Ie$=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K,Q,R,Jn,s$,u7,Gp,kG,jC,w9,G,t,Z,V,H,kY,iD,DM,a,QR,jH,eH,P6,fk,b7,KC,YY,n8,bI,N3,gf,EV,ni,dN,M_,hs,X7,c4,uI,P4,dl,Ja,GQ,kN,Li,DP,IC,fX;
return g.O(function(NT){switch(NT.Y){case 1:return z=Cy(k),x=k.entityKey,D=g.xW(x).entityId,e=[],C=!1,D==="!*$_ALL_ENTITIES_!*$"?(C=!0,g.c(NT,W_(F.Y,"mainPlaylistEntity"),5)):g.c(NT,KO(F.Y,x,"mainPlaylistEntity"),4);case 4:(p=NT.L)&&e.push(p);NT.Sk(3);break;case 5:e=NT.L;case 3:if((E=e)==null||!E.length)return NT.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));X=g.J(k.actionMetadata,VdC);N=(q=X)==null?void 0:q.nextAutoRefreshIntervalSeconds;w=(u=X)==null?void 0:u.autoSync;m=[];B=h=
!0;U=!1;if(!C&&w===!1){NT.Sk(6);break}g.lD(NT,7);return g.c(NT,Lb$(0,!!w,!0,e),9);case 9:m=NT.L;g.sC(NT,8);break;case 7:v=g.rI(NT);if(!(v instanceof Error&&v.message==="No data")){v instanceof Error&&v.message==="Empty response body"&&xv(v.message);NT.Sk(8);break}return D==="!*$_ALL_ENTITIES_!*$"?g.c(NT,trp(F.Y,k,F.U,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.c(NT,GAA(D,F.Y,k,F.U),8);case 8:if(!m.length||!C&&m[0].playlistId!==D)return NT.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
z));case 6:if(C){P=[];I=g.l(m);for(d=I.next();!d.done;d=I.next())W=d.value,W.upToDate||w&&!W.shouldAutoSyncMetadata||!W.playlistId||(M={nextAutoRefreshIntervalSeconds:W.checkInSeconds,autoSync:w},P.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",W.playlistId,"mainPlaylistEntity",0,MP,{mainPlaylistEntityActionMetadata:M})));return NT.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,P))}m.length&&(xY=m[0],U=!!xY.upToDate,w&&(h=($Y=xY.shouldAutoSyncMetadata)!=null?$Y:!0,B=(Fx=xY.shouldAutoSyncVideos)!=
null?Fx:!0,xY.checkInSeconds&&(N=xY.checkInSeconds)));if(U||!h)return NT.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));y=[];K=e[0];if(!K.downloadState){Q=void 0;NT.Sk(15);break}return g.c(NT,KO(F.Y,K.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Q=NT.L;case 15:return R=Q,s$=((Jn=R)==null?0:Jn.addedTimestampMillis)?String(R.addedTimestampMillis):void 0,g.lD(NT,17),g.c(NT,cFl(F,D,s$,N),19);case 19:y=NT.L;g.sC(NT,18);break;case 17:u7=g.rI(NT);if(!(u7 instanceof Error&&
u7.message==="No data for playlist")){if(u7 instanceof Error&&u7.message==="Empty response body for playlist")xv(u7.message);else return Gp="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",kG="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u7 instanceof g.h6&&u7.type==="QUOTA_EXCEEDED"&&(Gp="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",kG="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),NT.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,Gp,kG));NT.Sk(18);
break}return g.c(NT,GAA(D,F.Y,k,F.U),18);case 18:if(!B)return NT.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));jC=[];w9=new Map;if((G=y)==null?0:G.length)for(t=g.l(y),Z=t.next();!Z.done;Z=t.next())V=Z.value,H=V.offlineVideoData,kY=void 0,((kY=H)==null?0:kY.videoId)&&w9.set(H.videoId,H);iD=new Map;DM=[];if((a=K)==null?0:(QR=a.videos)==null?0:QR.length)for(jH=g.l(K.videos),eH=jH.next();!eH.done;eH=jH.next())if(P6=eH.value,fk=JSON.parse(g.xW(P6).entityId),b7=fk.videoId)w9.has(b7)?(iD.set(b7,
w9.get(b7)),w9.delete(b7)):DM.push(b7);YY=Number(((KC=k.actionMetadata)==null?void 0:KC.priority)||0)+1;n8=g.l(w9.entries());for(bI=n8.next();!bI.done;bI=n8.next())N3=bI.value,gf=g.l(N3),EV=gf.next().value,ni=gf.next().value,dN=EV,M_=ni,jC.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",dN,"mainVideoEntity",YY,MP,PT7(k,M_,D)));hs=g.l(iD.entries());for(X7=hs.next();!X7.done;X7=hs.next())c4=X7.value,uI=g.l(c4),P4=uI.next().value,dl=uI.next().value,Ja=P4,GQ=dl,jC.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Ja,"mainVideoEntity",YY,MP,PT7(k,GQ,D)));kN=g.l(DM);for(Li=kN.next();!Li.done;Li=kN.next())DP=Li.value,IC={playlistId:D},fX={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:IC},jC.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",DP,"mainVideoEntity",0,MP,fX));return NT.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,jC))}})},H6C=function(F,k){var z,x,D,e;
return g.O(function(C){switch(C.Y){case 1:return z=Cy(k),g.lD(C,2),x=g.xW(k.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.c(C,trp(F.Y,k,F.U,(D=k.actionMetadata)==null?void 0:(e=D.offlineLoggingData)==null?void 0:e.offlineDeleteReason),5):g.c(C,GAA(x,F.Y,k,F.U),6);case 6:if(!F.YG.V("woffle_enable_main_downloads_library")){C.Sk(5);break}return g.c(C,I5G(F.Y,k.entityKey),5);case 5:g.sC(C,3);break;case 2:return g.rI(C),C.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return C.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z))}})},cFl=function(F,k,z,x){var D,e,C,p,E,X,q;
return g.O(function(N){switch(N.Y){case 1:return g.c(N,nmY([k]),2);case 2:return D=N.L,g.c(N,aeY(F,D[0],z,x),3);case 3:return e=N.L,C=e.mainPlaylistEntity,p=e.tOR,X=rit(C,(E=p)==null?void 0:E.avatar),g.lD(N,4),g.c(N,Q2(X),6);case 6:g.sC(N,5);break;case 4:q=g.rI(N),q instanceof Error&&q.message==="Failed to fetch"&&xv(q.message);case 5:return N.return(D[0].videos)}})},aeY=function(F,k,z,x){var D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I;
return g.O(function(d){switch(d.Y){case 1:D=Date.now().toString();z||(z=D);e=k.videos;C=k.playlistId;p=[];E=[];if(e)for(X=g.l(e),q=X.next();!q.done;q=X.next()){N=q.value;u=N.offlineVideoData;if(!u||!u.videoId)throw xv("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");w=u.videoId;m={videoId:w,playlistId:C};h={id:g.is(JSON.stringify(m),"mainPlaylistVideoEntity"),video:g.is(w,"mainVideoEntity")};p.push(h);E.push(h.id)}U={key:g.is(C,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:z,lastSyncedTimestampMillis:D};v={key:g.is(C,"mainPlaylistEntity"),playlistId:C,videos:E,title:k.title,thumbnailStyleData:SWY(k),visibility:b6l(k),downloadState:U.key};k.channel&&(P=k.channel.offlineChannelData,B=dg$(g.is(C,"ytMainChannelEntity"),P),v.channelOwner=B.id);((I=v)==null?0:I.entityMetadata)?(v.entityMetadata.offlineLastModifiedTimestampSeconds=k.lastModifiedTimestamp,x&&(v.entityMetadata.nextAutoRefreshIntervalSeconds=String(x))):v&&(v.entityMetadata={nextAutoRefreshIntervalSeconds:x?
String(x):void 0,offlineLastModifiedTimestampSeconds:k.lastModifiedTimestamp});g.lD(d,2);return g.c(d,LO(F.Y,{mode:"readwrite",nN:!0},function(W){var M=gr(W,v,"mainPlaylistEntity"),xY=gr(W,U,"mainPlaylistDownloadStateEntity");M=[M,xY];xY=g.l(p);for(var $Y=xY.next();!$Y.done;$Y=xY.next())M.push(gr(W,$Y.value,"mainPlaylistVideoEntity"));B&&M.push(gr(W,B,"ytMainChannelEntity"));return g.vA.all(M)}),4);
case 4:g.sC(d,3);break;case 2:throw g.rI(d),xv("PES failure for playlist"),Error("PES failure for playlist");case 3:return d.return({mainPlaylistEntity:v,tOR:B,Afp:p})}})},dg$=function(F,k){return{id:F,
channelId:k.channelId,title:k.title,avatar:k.thumbnail}},SWY=function(F){var k=[],z=F.videos;
z&&z.length>0&&k.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:z[0].offlineVideoData.thumbnail}}});if((F=F.additionalMetadadatas)&&F.length>0)for(F=g.l(F),z=F.next();!z.done;z=F.next()){var x=z.value.offlineBundleItemPlaylistData,D=void 0;z=(D=x)==null?void 0:D.style;D=void 0;x={collageThumbnail:{coverThumbnail:(D=x)==null?void 0:D.coverThumbnail}};switch(z){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":k.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:x});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":k.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:x});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":k.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:x});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":k.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:x})}}return k},b6l=function(F){switch(F.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},PT7=function(F,k,z){k={offlineVideoData:k,
playlistId:z};if(F=g.J(F.actionMetadata,VdC))k.maximumDownloadQuality=F.maximumDownloadQuality;return{mainVideoEntityActionMetadata:k}},JFl=function(F,k,z){this.Y=F;
this.YG=k;this.U=z},geY=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m;
return g.O(function(h){switch(h.Y){case 1:return z=Cy(k),x=g.xW(k.entityKey),D=x.entityId,e=g.J(k.actionMetadata,Ly),p=!((C=e)==null?0:C.playlistId),g.lD(h,2),g.c(h,yFl(F,D,void 0,(E=e)==null?void 0:E.offlineVideoData,p),4);case 4:g.sC(h,3);break;case 2:return X=g.rI(h),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.h6&&X.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
h.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,q,N));case 3:u=1;u=Number(((w=k.actionMetadata)==null?void 0:w.priority)||0)+1;var B=(B=g.J(k.actionMetadata,Ly))?{playbackDataActionMetadata:{maximumDownloadQuality:B.maximumDownloadQuality}}:void 0;m=Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",D,"playbackData",u,R67,B);return h.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,[m]))}})},YWp=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v;
return g.O(function(P){switch(P.Y){case 1:return z=Cy(k),x=g.xW(k.entityKey),D=x.entityId,g.c(P,KO(F.Y,k.entityKey,"mainVideoEntity"),2);case 2:e=P.L;if(!e){C=void 0;P.Sk(3);break}return g.c(P,KO(F.Y,e.downloadState,"mainVideoDownloadStateEntity"),4);case 4:C=P.L;case 3:p=C;if(!e||!p)return P.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));g.lD(P,5);return g.c(P,yFl(F,D,p.addedTimestampMillis,(X=g.J(k.actionMetadata,Ly))==null?void 0:X.offlineVideoData),7);case 7:q=1;q=Number(((N=
k.actionMetadata)==null?void 0:N.priority)||0)+1;E=Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D,"playbackData",q,R67);g.sC(P,6);break;case 5:u=g.rI(P);if(!(u instanceof Error&&u.message==="No data")){if(u instanceof Error&&u.message==="Empty response body")xv(u.message);else return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.h6&&u.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,w,m));P.Sk(6);break}return g.c(P,rD(F.Y,D),9);case 9:h=P.L;B=g.J(k.actionMetadata,Ly);if(v=(U=B)==null?void 0:U.playlistId)h.playlistId=v;h.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.c(P,hG(D,F.Y,k,F.U,h),6);case 6:return P.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,E?[E]:void 0))}})},neA=function(F,k){var z,x,D,e,C,p,E,X,q,N;
return g.O(function(u){switch(u.Y){case 1:return z=Cy(k),g.lD(u,2),x=g.xW(k.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.c(u,trp(F.Y,k,F.U,(q=k.actionMetadata)==null?void 0:(N=q.offlineLoggingData)==null?void 0:N.offlineDeleteReason),5):g.c(u,rD(F.Y,x),6);case 6:D=u.L;e=g.J(k.actionMetadata,Ly);if(p=(C=e)==null?void 0:C.playlistId)D.playlistId=p;D.offlineDeleteReason=(E=k.actionMetadata)==null?void 0:(X=E.offlineLoggingData)==null?void 0:X.offlineDeleteReason;return g.c(u,hG(x,F.Y,k,F.U,D),7);
case 7:if(!F.YG.V("woffle_enable_main_downloads_library")){u.Sk(5);break}return g.c(u,I5G(F.Y,k.entityKey),5);case 5:g.sC(u,3);break;case 2:return g.rI(u),u.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return u.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z))}})},yFl=function(F,k,z,x,D){var e,C,p,E,X,q;
return g.O(function(N){switch(N.Y){case 1:if(e=x){N.Sk(2);break}return g.c(N,Ygn([k]),3);case 3:C=N.L,e=C[0];case 2:return g.c(N,Mdn(F,e,z,D),4);case 4:p=N.L;E=p.mainVideoEntity;X=p.channelEntity;g.lD(N,5);var u=uS(E.thumbnail),w=uS(X.avatar);return g.c(N,Q2(u.concat(w)),7);case 7:g.sC(N,0);break;case 5:q=g.rI(N),q instanceof Error&&q.message==="Failed to fetch"&&xv(q.message),g.Tp(N)}})},Mdn=function(F,k,z,x){var D,e,C,p,E,X,q,N,u,w,m,h,B;
return g.O(function(U){switch(U.Y){case 1:z||(z=Date.now().toString());e=(D=k.channel)==null?void 0:D.offlineChannelData;C={id:g.is(k.videoId,"ytMainChannelEntity"),channelId:e.channelId,title:e.title,avatar:e.thumbnail};p={key:g.is(k.videoId,"mainVideoDownloadStateEntity"),playbackData:g.is(k.videoId,"playbackData"),addedTimestampMillis:z,videoDownloadContextEntity:g.is(k.videoId,"videoDownloadContextEntity")};E={key:g.is(k.videoId,"videoPlaybackPositionEntity"),videoId:k.videoId,lastPlaybackPositionSeconds:"0"};
F.YG.V("html5_offline_playback_position_sync")&&(X={playbackPosition:E.key});q=g.is(k.videoId,"mainVideoEntity");N={key:q,videoId:k.videoId,title:k.title,thumbnail:k.thumbnail,localizedStrings:{viewCount:k.shortViewCountText},userState:X,lengthSeconds:k.lengthSeconds?Number(k.lengthSeconds):void 0,publishedTimestampMillis:k.publishedTimestamp?(Number(k.publishedTimestamp)*1E3).toString():void 0,formattedDescription:k.description,owner:C.id,downloadState:p.key};if(!F.YG.V("woffle_enable_main_downloads_library")||
!x){U.Sk(2);break}return g.c(U,OTt(F.Y,[q]),3);case 3:if(m=U.L)u=m.mainDownloadsLibraryEntity,w=m.mainDownloadsListEntity;case 2:return B=ml$,h={key:g.is(k.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.ME(p,B,h),g.c(U,LO(F.Y,{mode:"readwrite",nN:!0},function(v){var P=gr(v,C,"ytMainChannelEntity"),I=gr(v,p,"mainVideoDownloadStateEntity"),d=gr(v,N,"mainVideoEntity");P=[P,I,d];F.YG.V("html5_offline_playback_position_sync")&&(I=gr(v,E,"videoPlaybackPositionEntity"),
P.push(I));u&&(I=gr(v,u,"mainDownloadsLibraryEntity"),P.push(I));w&&(I=gr(v,w,"mainDownloadsListEntity"),P.push(I));h&&(v=gr(v,h,"downloadStatusEntity"),P.push(v));return g.vA.all(P)}),4);
case 4:return U.return({mainVideoEntity:N,channelEntity:C})}})},LC$=function(F,k,z){this.Y=F;
this.YG=k;this.U=z},KCH=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K;
return g.O(function(Q){switch(Q.Y){case 1:return z=Cy(k),x=[],g.c(Q,SV.getInstance(),2);case 2:D=Q.L;if(!D){Q.Sk(3);break}return g.c(Q,D.get("sdois"),4);case 4:return e=Q.L,g.c(Q,(p=D)==null?void 0:p.get("lmqf"),5);case 5:C=Q.L;case 3:g.lD(Q,6);if(e===void 0)throw Error("prefStorage or opt-in state is undefined");E=[];if(e){Q.Sk(8);break}return g.c(Q,PRt(F.Y),9);case 9:E=Q.L,E.reverse();case 8:if(!E.length){Q.Sk(10);break}X=g.l(E);q=X.next();case 11:if(q.done){Q.Sk(10);break}N=q.value;if(!N){Q.Sk(12);
break}u=g.xW(N).entityId;return g.c(Q,rD(F.Y,u),14);case 14:return w=Q.L,w.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.c(Q,hG(u,F.Y,{entityKey:N,actionType:k.actionType},F.U,w),12);case 12:q=X.next();Q.Sk(11);break;case 10:return g.c(Q,Kb$(e,(m=C)!=null?m:"SD"),16);case 16:return h=Q.L,g.c(Q,ZTC(h),17);case 17:B=ciC(h);if(!F.YG.V("woffle_enable_main_downloads_library")){Q.Sk(18);break}if(e){Q.Sk(19);break}return g.c(Q,I5G(F.Y,g.P$),19);case 19:return g.c(Q,VrA(F.Y,[g.P$]),18);
case 18:if((U=B)==null?0:U.length)for(v=g.l(B),P=v.next();!P.done;P=v.next())if(d=I=P.value,W=d.actionType,M=d.entityKey,xY=d.actionMetadata,W&&M&&xY&&!g.J(xY,fet)){W==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(xY.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if($Y=g.J(I.actionMetadata,Ly))$Y.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",I.actionMetadata=Object.assign({},I.actionMetadata,{mainVideoEntityActionMetadata:$Y});x.push(I)}g.sC(Q,7);break;
case 6:return Fx=g.rI(Q),y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Fx instanceof g.h6&&Fx.type==="QUOTA_EXCEEDED"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Q.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,y,K));case 7:return Q.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,x))}})},WCH=function(){Yv.apply(this,arguments);
this.K="mainVideoEntity"},F3t=function(F,k,z){k=k===void 0?43200:k;
z=z===void 0?!0:z;var x=x===void 0?!1:x;var D,e,C;return g.O(function(p){switch(p.Y){case 1:if(!F.S.bG())return p.return([]);D=[];g.lD(p,2);return g.c(p,Lb$(k,z,x),4);case 4:D=p.L;g.sC(p,3);break;case 2:e=g.rI(p),e instanceof Error&&e.message==="No data"||e instanceof Error&&e.message==="Empty response body"&&xv(e.message);case 3:return C=tdn(F,D,z,"mainPlaylistEntity"),p.return(C)}})},ks$=function(F,k,z,x){x=x===void 0?!1:x;
var D,e,C,p,E,X,q,N,u,w,m,h,B,U,v;return g.O(function(P){switch(P.Y){case 1:return D=[],g.c(P,f57(),2);case 2:return(e=P.L)||x?g.c(P,WbV(k,z),3):P.return([]);case 3:C=P.L;if((p=C)==null||!p.length)return P.return([]);E={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};X=g.l(C);q=X.next();case 4:if(q.done){P.Sk(6);break}u=N=q.value;w=u.actionType;m=u.entityKey;h=u.actionMetadata;if(!(w&&m&&h)||g.J(h,fet)){P.Sk(5);break}w==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(h.offlineLoggingData=
E);B=g.xW(m);U=B.entityId;return g.c(P,ny(F,[U],"mainVideoEntity",w,h),8);case 8:v=P.L,D=D.concat(v);case 5:q=X.next();P.Sk(4);break;case 6:return P.return(D)}})},ocC=function(F,k){this.Y=F;
this.U=k},xJt=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U;
return g.O(function(v){switch(v.Y){case 1:return z=Cy(k),x=g.xW(k.entityKey),D=x.entityId,e=[],g.lD(v,2),g.c(v,zJt(F,D),4);case 4:e=v.L;if((C=e)==null||!C.length){v.Sk(5);break}return g.c(v,dll(F.Y,k.entityKey),5);case 5:g.sC(v,3);break;case 2:return p=g.rI(v),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.h6&&p.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,E,X));case 3:return q=[],g.c(v,TC9(F.Y,"musicTrack",e),7);case 7:e=v.L;if(e.length)for(N=g.l(e),u=N.next();!u.done;u=N.next())if(w=u.value,m=w.offlineVideoData,h=void 0,(h=m)==null?0:h.videoId)B=void 0,U=Number(((B=k.actionMetadata)==null?void 0:B.priority)||0)+1,q.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m.videoId,"musicTrack",U,fy,tG(k,m,D)));return v.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,q))}})},
iXA=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K,Q,R,Jn,s$,u7,Gp,kG,jC,w9,G,t,Z,V,H,kY,iD,DM,a,QR,jH,eH,P6,fk,b7,KC,YY,n8,bI,N3,gf,EV,ni;
return g.O(function(dN){switch(dN.Y){case 1:return z=Cy(k),x=k.entityKey,D=g.xW(x).entityId,e=[],C=!1,D==="!*$_ALL_ENTITIES_!*$"?(C=!0,g.c(dN,W_(F.Y,"musicAlbumRelease"),5)):g.c(dN,KO(F.Y,x,"musicAlbumRelease"),4);case 4:(p=dN.L)&&e.push(p);dN.Sk(3);break;case 5:e=dN.L;case 3:if((E=e)==null||!E.length)return dN.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));if(C){X=[];q=g.l(e);for(N=q.next();!N.done;N=q.next())u=N.value,w=g.xW(u.id).entityId,X.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
w,"musicAlbumRelease",0,fy));return dN.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,X))}m=[];h=e[0];B=void 0;if(!h.downloadMetadata){dN.Sk(6);break}return g.c(dN,KO(F.Y,h.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:U=dN.L,B=Number((P=(v=U)==null?void 0:v.addedTimestampMillis)!=null?P:"0")/1E3;case 6:return g.lD(dN,8),g.c(dN,zJt(F,D,(I=B)==null?void 0:I.toString()),10);case 10:m=dN.L;g.sC(dN,9);break;case 8:d=g.rI(dN);if(!(d instanceof Error&&d.message===
"No data")){if(d instanceof Error&&d.message==="Empty response body")xv(d.message);else return W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.h6&&d.type==="QUOTA_EXCEEDED"&&(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),dN.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,W,M));dN.Sk(9);break}return g.c(dN,Gq(D,"musicAlbumRelease",F.Y,
k,F.U),9);case 9:xY=[];$Y=new Map;if((Fx=m)==null?0:Fx.length)for(y=g.l(m),K=y.next();!K.done;K=y.next())Q=K.value,R=Q.offlineVideoData,Jn=void 0,((Jn=R)==null?0:Jn.videoId)&&$Y.set(R.videoId,R);s$=new Map;u7=[];if((Gp=h)==null?0:(kG=Gp.tracks)==null?0:kG.length)for(jC=g.l(h.tracks),w9=jC.next();!w9.done;w9=jC.next())if(G=w9.value,t=g.xW(G).entityId)$Y.has(t)?(s$.set(t,$Y.get(t)),$Y.delete(t)):u7.push(t);V=Number(((Z=k.actionMetadata)==null?void 0:Z.priority)||0)+1;H=g.l($Y.entries());for(kY=H.next();!kY.done;kY=
H.next())iD=kY.value,DM=g.l(iD),a=DM.next().value,QR=DM.next().value,jH=a,eH=QR,xY.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",jH,"musicTrack",V,fy,tG(k,eH)));P6=g.l(s$.entries());for(fk=P6.next();!fk.done;fk=P6.next())b7=fk.value,KC=g.l(b7),YY=KC.next().value,n8=KC.next().value,bI=YY,N3=n8,xY.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",bI,"musicTrack",V,fy,tG(k,N3)));gf=g.l(u7);for(EV=gf.next();!EV.done;EV=gf.next())ni=EV.value,xY.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",ni,
"musicTrack",0,fy));return dN.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,xY))}})},DJ$=function(F,k){var z,x;
return g.O(function(D){switch(D.Y){case 1:return z=Cy(k),g.lD(D,2),x=g.xW(k.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.c(D,Uo(F.Y,k,F.U),5):g.c(D,Gq(x,"musicAlbumRelease",F.Y,k,F.U),6);case 6:return g.c(D,Jil(F.Y,k.entityKey),5);case 5:g.sC(D,3);break;case 2:return g.rI(D),D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
z))}})},zJt=function(F,k,z){var x,D,e;
return g.O(function(C){switch(C.Y){case 1:return g.c(C,nmY([k]),2);case 2:return x=C.L,g.c(C,$JD(F,x[0],z),3);case 3:return D=C.L,e=uS(D.thumbnailDetails),g.c(C,Q2(e),4);case 4:return C.return(x[0].videos)}})},$JD=function(F,k,z){var x,D,e,C,p,E,X,q,N,u,w,m,h,B;
return g.O(function(U){if(U.Y==1){x=k.additionalMetadadatas;D=void 0;if(x&&x.length>0)for(e=g.l(x),C=e.next();!C.done;C=e.next())if(p=C.value,p.offlineMusicPlaylistData){D=p.offlineMusicPlaylistData;break}E=k.playlistId;X=yiC(k);q=X.hN;N=X.jo;u=z?(Number(z)*1E3).toString():Date.now().toString();w=k.lastModifiedTimestamp?(Number(k.lastModifiedTimestamp)*1E3).toString():"0";m={id:g.is(E,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:N,lastModifiedTimestampMillis:w,addedTimestampMillis:u,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};h={id:g.is(E,"musicAlbumRelease"),title:k.title,audioPlaylistId:E,trackCount:k.totalVideoCount,tracks:q,downloadMetadata:m.id};D&&(h.thumbnailDetails=(B=D.albumHqThumbnail)!=null?B:D.albumArtistThumbnail,h.artistDisplayName=D.albumArtistDisplayName,h.releaseDate=D.albumReleaseDate,h.contentRating={explicitType:D.albumReleaseExplicitType},h.releaseType=D.albumReleaseType);return g.c(U,LO(F.Y,{mode:"readwrite",nN:!0},function(v){var P=gr(v,h,"musicAlbumRelease");
v=gr(v,m,"musicAlbumReleaseDownloadMetadataEntity");return g.vA.all([P,v])}),2)}return U.return(h)})},jAA=function(F,k){this.Y=F;
this.U=k},C1l=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U;
return g.O(function(v){switch(v.Y){case 1:return z=Cy(k),x=g.xW(k.entityKey),D=x.entityId,e=[],g.lD(v,2),g.c(v,eJY(F,D),4);case 4:e=v.L;if((C=e)==null||!C.length){v.Sk(5);break}return g.c(v,dll(F.Y,k.entityKey),5);case 5:g.sC(v,3);break;case 2:return p=g.rI(v),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.h6&&p.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,E,X));case 3:return q=[],g.c(v,TC9(F.Y,"musicTrack",e),7);case 7:e=v.L;if(e.length)for(N=g.l(e),u=N.next();!u.done;u=N.next())if(w=u.value,m=w.offlineVideoData,h=void 0,(h=m)==null?0:h.videoId)B=void 0,U=Number(((B=k.actionMetadata)==null?void 0:B.priority)||0)+1,q.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m.videoId,"musicTrack",U,Ky,tG(k,m,D)));return v.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,q))}})},
AUG=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K,Q,R,Jn,s$,u7,Gp,kG,jC,w9,G,t,Z,V,H,kY,iD,DM,a,QR,jH,eH,P6,fk,b7,KC,YY,n8,bI,N3,gf,EV,ni,dN,M_,hs,X7,c4,uI,P4,dl,Ja,GQ,kN,Li;
return g.O(function(DP){switch(DP.Y){case 1:return z=Cy(k),x=k.entityKey,D=g.xW(x).entityId,e=[],C=!1,D==="!*$_ALL_ENTITIES_!*$"?(C=!0,g.c(DP,W_(F.Y,"musicPlaylist"),5)):g.c(DP,KO(F.Y,x,"musicPlaylist"),4);case 4:(p=DP.L)&&e.push(p);DP.Sk(3);break;case 5:e=DP.L;case 3:if((E=e)==null||!E.length)return DP.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));X=g.J(k.actionMetadata,R4$);N=(q=X)==null?void 0:q.autoSync;u=[];m=w=!0;h=!1;B=void 0;if(!C&&N===!1){DP.Sk(6);break}g.lD(DP,7);return g.c(DP,
F6Y(0,!!N,!0,e),9);case 9:u=DP.L;g.sC(DP,8);break;case 7:U=g.rI(DP);if(!(U instanceof Error&&U.message==="No data")){U instanceof Error&&U.message==="Empty response body"&&xv(U.message);DP.Sk(8);break}return D==="!*$_ALL_ENTITIES_!*$"?g.c(DP,Uo(F.Y,k,F.U),8):g.c(DP,Gq(D,"musicPlaylist",F.Y,k,F.U),8);case 8:if(!u.length||!C&&u[0].playlistId!==D)return DP.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));case 6:if(C){v=[];P=g.l(u);for(I=P.next();!I.done;I=P.next())d=I.value,d.upToDate||
N&&!d.shouldAutoSyncMetadata||!d.playlistId||(W={autoSync:N},v.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d.playlistId,"musicPlaylist",0,Ky,{musicPlaylistEntityActionMetadata:W})));return DP.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,v))}u.length&&(M=u[0],h=!!M.upToDate,N&&(w=(xY=M.shouldAutoSyncMetadata)!=null?xY:!0,m=($Y=M.shouldAutoSyncVideos)!=null?$Y:!0,M.checkInSeconds&&(B=M.checkInSeconds)));if(h||!w)return DP.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
z));Fx=[];y=e[0];K=void 0;if(!y.downloadMetadata){DP.Sk(15);break}return g.c(DP,KO(F.Y,y.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Q=DP.L,K=Number((Jn=(R=Q)==null?void 0:R.addedTimestampMillis)!=null?Jn:"0")/1E3;case 15:return g.lD(DP,17),g.c(DP,eJY(F,D,(s$=K)==null?void 0:s$.toString(),B),19);case 19:Fx=DP.L;g.sC(DP,18);break;case 17:u7=g.rI(DP);if(!(u7 instanceof Error&&u7.message==="No data")){if(u7 instanceof Error&&u7.message==="Empty response body")xv(u7.message);else return Gp=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",kG="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u7 instanceof g.h6&&u7.type==="QUOTA_EXCEEDED"&&(Gp="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",kG="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),DP.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,Gp,kG));DP.Sk(18);break}return g.c(DP,Gq(D,"musicPlaylist",F.Y,k,F.U),18);case 18:if(!m)return DP.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
z));jC=[];w9=new Map;if((G=Fx)==null?0:G.length)for(t=g.l(Fx),Z=t.next();!Z.done;Z=t.next())V=Z.value,H=V.offlineVideoData,kY=void 0,((kY=H)==null?0:kY.videoId)&&w9.set(H.videoId,H);iD=new Map;DM=[];if((a=y)==null?0:(QR=a.tracks)==null?0:QR.length)for(jH=g.l(y.tracks),eH=jH.next();!eH.done;eH=jH.next())if(P6=eH.value,fk=g.xW(P6).entityId)w9.has(fk)?(iD.set(fk,w9.get(fk)),w9.delete(fk)):DM.push(fk);KC=Number(((b7=k.actionMetadata)==null?void 0:b7.priority)||0)+1;YY=g.l(w9.entries());for(n8=YY.next();!n8.done;n8=
YY.next())bI=n8.value,N3=g.l(bI),gf=N3.next().value,EV=N3.next().value,ni=gf,dN=EV,jC.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",ni,"musicTrack",KC,Ky,tG(k,dN)));M_=g.l(iD.entries());for(hs=M_.next();!hs.done;hs=M_.next())X7=hs.value,c4=g.l(X7),uI=c4.next().value,P4=c4.next().value,dl=uI,Ja=P4,jC.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",dl,"musicTrack",KC,Ky,tG(k,Ja)));GQ=g.l(DM);for(kN=GQ.next();!kN.done;kN=GQ.next())Li=kN.value,jC.push(Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Li,"musicTrack",0,Ky));return DP.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,jC))}})},pIG=function(F,k){var z,x;
return g.O(function(D){switch(D.Y){case 1:return z=Cy(k),g.lD(D,2),x=g.xW(k.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.c(D,Uo(F.Y,k,F.U),5):g.c(D,Gq(x,"musicPlaylist",F.Y,k,F.U),6);case 6:return g.c(D,Jil(F.Y,k.entityKey),5);case 5:g.sC(D,3);break;case 2:return g.rI(D),D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
z))}})},eJY=function(F,k,z,x){var D,e,C;
return g.O(function(p){switch(p.Y){case 1:return g.c(p,nmY([k]),2);case 2:return D=p.L,g.c(p,EcV(F,D[0],z,x),3);case 3:return e=p.L,C=uS(e.thumbnailDetails),g.c(p,Q2(C),4);case 4:return p.return(D[0].videos)}})},EcV=function(F,k,z,x){var D,e,C,p,E,X,q,N,u;
return g.O(function(w){return w.Y==1?(D=k.playlistId,e=yiC(k),C=e.hN,p=e.jo,E=z?(Number(z)*1E3).toString():Date.now().toString(),X=k.lastModifiedTimestamp?(Number(k.lastModifiedTimestamp)*1E3).toString():"0",q={id:g.is(D,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:p,lastModifiedTimestampMillis:X,addedTimestampMillis:E,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},N={id:g.is(D,"musicPlaylist"),title:k.title,playlistId:D,thumbnailDetails:k.thumbnail,visibility:XIl(k),trackCount:k.totalVideoCount,
tracks:C,downloadMetadata:q.id},x&&(((u=N)==null?0:u.entityMetadata)?N.entityMetadata.nextAutoRefreshIntervalSeconds=String(x):N&&(N.entityMetadata={nextAutoRefreshIntervalSeconds:String(x)})),g.c(w,LO(F.Y,{mode:"readwrite",nN:!0},function(m){var h=gr(m,N,"musicPlaylist");m=gr(m,q,"musicPlaylistDownloadMetadataEntity");return g.vA.all([h,m])}),2)):w.return(N)})},XIl=function(F){switch(F.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},qr$=function(F,k){this.Y=F;
this.U=k},mJt=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m;
return g.O(function(h){switch(h.Y){case 1:return z=Cy(k),x=g.xW(k.entityKey),D=x.entityId,e=g.J(k.actionMetadata,NUC),g.lD(h,2),g.c(h,ukY(F,D,void 0,(C=e)==null?void 0:C.track,(p=e)==null?void 0:p.albumRelease),4);case 4:if((E=e)==null?0:E.playlistId){h.Sk(5);break}return g.c(h,dll(F.Y,k.entityKey),5);case 5:g.sC(h,3);break;case 2:return X=g.rI(h),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.h6&&X.type==="QUOTA_EXCEEDED"&&
(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),h.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,q,N));case 3:w=Number(((u=k.actionMetadata)==null?void 0:u.priority)||0)+1;var B=(B=g.J(k.actionMetadata,NUC))?{playbackDataActionMetadata:{maximumDownloadQuality:B.maximumDownloadQuality}}:void 0;m=Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",D,"playbackData",w,wIH,B);return h.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
z,[m]))}})},TUC=function(F,k){var z,x,D,e,C,p,E,X,q,N,u,w,m,h,B;
return g.O(function(U){switch(U.Y){case 1:return z=Cy(k),x=g.xW(k.entityKey),D=x.entityId,g.c(U,KO(F.Y,k.entityKey,"musicTrack"),2);case 2:e=U.L;if(!e){C=void 0;U.Sk(3);break}return g.c(U,KO(F.Y,e.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:C=U.L;case 3:p=C;if(!e||!p)return U.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z));X=g.J(k.actionMetadata,NUC);g.lD(U,5);return g.c(U,ukY(F,D,p.addedTimestampMillis,(q=X)==null?void 0:q.track,(N=X)==null?void 0:N.albumRelease),
7);case 7:w=Number(((u=k.actionMetadata)==null?void 0:u.priority)||0)+1;E=Pd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D,"playbackData",w,wIH);g.sC(U,6);break;case 5:m=g.rI(U);if(!(m instanceof Error&&m.message==="No data")){if(m instanceof Error&&m.message==="Empty response body")xv(m.message);else return h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.h6&&m.type==="QUOTA_EXCEEDED"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),U.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,h,B));U.Sk(6);break}return g.c(U,Bd(D,F.Y,k,F.U),6);case 6:return U.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",z,E?[E]:void 0))}})},l3G=function(F,k){var z,x;
return g.O(function(D){switch(D.Y){case 1:return z=Cy(k),g.lD(D,2),x=g.xW(k.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.c(D,Uo(F.Y,k,F.U),5):g.c(D,Bd(x,F.Y,k,F.U),6);case 6:return g.c(D,Jil(F.Y,k.entityKey),5);case 5:g.sC(D,3);break;case 2:return g.rI(D),D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new Oo("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
z))}})},ukY=function(F,k,z,x,D){var e,C,p,E,X,q;
return g.O(function(N){switch(N.Y){case 1:if(e=x){N.Sk(2);break}return g.c(N,Ygn([k]),3);case 3:C=N.L,p=C[0],e=bT$(p);case 2:return g.c(N,QAC(F,e,k,D,z),4);case 4:E=N.L;X=E.musicTrackEntity;q=E.NT;var u=uS(X.thumbnailDetails),w=[];q&&(w=uS(q.thumbnailDetails));return g.c(N,Q2(u.concat(w)),0)}})},QAC=function(F,k,z,x,D){var e;
return g.O(function(C){return C.Y==1?(D||(D=Date.now().toString()),e={id:g.is(z,"musicTrackDownloadMetadataEntity"),playbackData:g.is(z,"playbackData"),addedTimestampMillis:D,videoDownloadContextEntity:g.is(z,"videoDownloadContextEntity")},x&&(k.albumRelease=x.id),g.c(C,LO(F.Y,{mode:"readwrite",nN:!0},function(p){var E=[],X=gr(p,e,"musicTrackDownloadMetadataEntity");E.push(X);X=gr(p,k,"musicTrack");E.push(X);x&&(p=gr(p,x,"musicAlbumRelease"),E.push(p));return g.vA.all(E)}),2)):C.Y!=3?g.c(C,XL(z,"musicTrackDownloadMetadataEntity",
F.Y,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):C.return({musicTrackEntity:k,
NT:x})})},Wd=function(){Yv.apply(this,arguments);
this.K="musicTrack"},hJC=function(F,k,z){k=k===void 0?43200:k;
z=z===void 0?!0:z;var x=x===void 0?!1:x;var D,e;return g.O(function(C){switch(C.Y){case 1:if(!F.S.bG())return C.return([]);D=[];g.lD(C,2);return g.c(C,F6Y(k,z,x),4);case 4:D=C.L;g.sC(C,3);break;case 2:g.rI(C);case 3:return e=tdn(F,D,z,"musicPlaylist"),C.return(e)}})},sAH=function(){g.XP.apply(this,arguments);
var F=this;this.events=new g.yQ(this);this.YG=this.player.C();this.Pe={cgf:function(){return F.Y},
rY:function(){return F.rY()},
ST:function(k){return F.ST(k)}}},rU7=function(F){var k;
F=g.J((k=F.getWatchNextResponse())==null?void 0:k.currentVideoEndpoint,g.W3);if(F==null?0:F.playlistId)var z=F.playlistId;return z},BU9=function(F,k){var z,x,D,e;
return g.O(function(C){if(C.Y==1){z=k.clientPlaybackNonce;x={cpn:z,offlineSourceVisualElement:g.vz(k.Xf||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};k.L&&(x.videoFmt=Number(k.L.itag));k.j&&(x.audioFmt=Number(k.j.itag));if((D=rU7(k))&&k.videoId){var p=k.videoId;p=D!=="PPSV"?Promise.resolve(!1):F.Y.QU(p);C=g.c(C,p,3)}else C=C.Sk(2);return C}C.Y!=2&&(e=C.L)&&(x.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");F.L=z;g.NA("offlinePlaybackStarted",x);g.Tp(C)})};
g.tM.prototype.xO=g.Ck(51,function(F){return this.app.xO(F)});
g.um.prototype.xO=g.Ck(50,function(F){return g.FwH(this,9,F)});
g.T(H_,If);g.An.Object.defineProperties(H_.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.Y.entityMetadata},
set:function(F){this.Y.entityMetadata=F}}});
g.T(TlD,H_);TlD.prototype.L=function(){return[]};
g.T(lEt,H_);lEt.prototype.L=function(){return[]};
g.T(Q49,H_);Q49.prototype.L=function(){return[]};
g.T(hOC,H_);hOC.prototype.L=function(){return[]};
g.T(s4C,H_);s4C.prototype.L=function(){var F=[];this.Y.alternateChannel&&F.push(this.Y.alternateChannel);this.Y.alternateChannelList&&F.push.apply(F,g.r(this.Y.alternateChannelList));this.Y.oneofChannelEntity&&F.push(this.Y.oneofChannelEntity);return[].concat(g.r(new Set(F)))};
g.T(raC,H_);raC.prototype.L=function(){var F=[];this.Y.entryCollection&&F.push(this.Y.entryCollection);return[].concat(g.r(new Set(F)))};
g.T(BlH,If);BlH.prototype.L=function(){var F=[];this.Y.video&&F.push(this.Y.video);return[].concat(g.r(new Set(F)))};
g.T(GiV,H_);GiV.prototype.L=function(){var F=[];this.Y.parentPlaylist&&F.push(this.Y.parentPlaylist);if(this.Y.entries)for(var k=g.l(this.Y.entries),z=k.next();!z.done;z=k.next())F.push.apply(F,g.r((new BlH(z.value)).L()));return[].concat(g.r(new Set(F)))};
g.T(Ur$,H_);Ur$.prototype.L=function(){var F=[];this.Y.descriptionEntity&&F.push(this.Y.descriptionEntity);this.Y.creators&&F.push.apply(F,g.r(this.Y.creators));this.Y.theBiggestFan&&F.push(this.Y.theBiggestFan);return[].concat(g.r(new Set(F)))};
g.T(tKV,H_);tKV.prototype.L=function(){return[]};
g.T(Zf$,H_);Zf$.prototype.L=function(){return[]};
g.T(vDH,H_);vDH.prototype.L=function(){return[]};
g.T(caC,H_);caC.prototype.L=function(){return[]};
g.T(P8$,H_);P8$.prototype.L=function(){return[]};
g.T(OfC,H_);OfC.prototype.L=function(){return[]};
g.T(VK9,H_);VK9.prototype.L=function(){return[]};
g.T(IEV,H_);IEV.prototype.L=function(){return[]};
g.T(Hf7,H_);Hf7.prototype.L=function(){return[]};
g.T(aE$,H_);aE$.prototype.L=function(){var F=[];this.Y.downloadsList&&F.push(this.Y.downloadsList);this.Y.smartDownloadsList&&F.push(this.Y.smartDownloadsList);this.Y.recommendedDownloadsList&&F.push(this.Y.recommendedDownloadsList);this.Y.refresh&&F.push(this.Y.refresh);return[].concat(g.r(new Set(F)))};
g.T(SFH,If);SFH.prototype.L=function(){var F=[];this.Y.video&&F.push(this.Y.video);this.Y.playlist&&F.push(this.Y.playlist);this.Y.videoItem&&F.push(this.Y.videoItem);this.Y.playlistItem&&F.push(this.Y.playlistItem);return[].concat(g.r(new Set(F)))};
g.T(bf7,H_);bf7.prototype.L=function(){var F=[];this.Y.refresh&&F.push(this.Y.refresh);if(this.Y.downloads)for(var k=g.l(this.Y.downloads),z=k.next();!z.done;z=k.next())F.push.apply(F,g.r((new SFH(z.value)).L()));return[].concat(g.r(new Set(F)))};
g.T(drV,H_);drV.prototype.L=function(){var F=[];this.Y.localImageEntities&&F.push.apply(F,g.r(this.Y.localImageEntities));return[].concat(g.r(new Set(F)))};
g.T(JaD,H_);JaD.prototype.L=function(){var F=[];this.Y.playbackData&&F.push(this.Y.playbackData);this.Y.localImageEntities&&F.push.apply(F,g.r(this.Y.localImageEntities));this.Y.videoDownloadContextEntity&&F.push(this.Y.videoDownloadContextEntity);return[].concat(g.r(new Set(F)))};
g.T(yan,H_);yan.prototype.L=function(){return[]};
g.T(ROH,H_);ROH.prototype.L=function(){var F=[];this.Y.fakeChildren&&F.push.apply(F,g.r(this.Y.fakeChildren));return[].concat(g.r(new Set(F)))};
g.T(gD7,H_);gD7.prototype.L=function(){var F=[];this.Y.video&&F.push(this.Y.video);this.Y.playbackData&&F.push(this.Y.playbackData);this.Y.offlineVideoPolicy&&F.push(this.Y.offlineVideoPolicy);return[].concat(g.r(new Set(F)))};
g.T(YFC,H_);YFC.prototype.L=function(){return[]};
g.T(nDn,H_);nDn.prototype.L=function(){var F=[];this.Y.channelOwner&&F.push(this.Y.channelOwner);this.Y.videos&&F.push.apply(F,g.r(this.Y.videos));this.Y.collaboratorChannels&&F.push.apply(F,g.r(this.Y.collaboratorChannels));this.Y.downloadState&&F.push(this.Y.downloadState);this.Y.refresh&&F.push(this.Y.refresh);return[].concat(g.r(new Set(F)))};
g.T(MKn,H_);MKn.prototype.L=function(){var F=[];this.Y.video&&F.push(this.Y.video);this.Y.channelContributor&&F.push(this.Y.channelContributor);return[].concat(g.r(new Set(F)))};
g.T(L$G,If);L$G.prototype.L=function(){var F=[];this.Y.localImageEntities&&F.push.apply(F,g.r(this.Y.localImageEntities));this.Y.videoDownloadContextEntity&&F.push(this.Y.videoDownloadContextEntity);return[].concat(g.r(new Set(F)))};
g.T(fEA,If);fEA.prototype.L=function(){var F=[];this.Y.recommendedVideoMetadata&&F.push.apply(F,g.r((new L$G(this.Y.recommendedVideoMetadata)).L()));return[].concat(g.r(new Set(F)))};
g.T(K$n,If);K$n.prototype.L=function(){var F=[];this.Y.playbackPosition&&F.push(this.Y.playbackPosition);return[].concat(g.r(new Set(F)))};
g.T(W$n,H_);W$n.prototype.L=function(){var F=[];this.Y.owner&&F.push(this.Y.owner);this.Y.downloadState&&F.push(this.Y.downloadState);this.Y.userState&&F.push.apply(F,g.r((new K$n(this.Y.userState)).L()));this.Y.additionalMetadata&&F.push.apply(F,g.r((new fEA(this.Y.additionalMetadata)).L()));return[].concat(g.r(new Set(F)))};
g.T(FG7,H_);FG7.prototype.L=function(){var F=[];this.Y.userChannelDetails&&F.push(this.Y.userChannelDetails);return[].concat(g.r(new Set(F)))};
g.T(kyC,H_);kyC.prototype.L=function(){var F=[];this.Y.channelOwner&&F.push(this.Y.channelOwner);this.Y.playbackPosition&&F.push(this.Y.playbackPosition);this.Y.localImageEntities&&F.push.apply(F,g.r(this.Y.localImageEntities));this.Y.downloadStatus&&F.push(this.Y.downloadStatus);return[].concat(g.r(new Set(F)))};
g.T(okG,H_);okG.prototype.L=function(){return[]};
g.T(zrY,H_);zrY.prototype.L=function(){return[]};
g.T(x2$,H_);x2$.prototype.L=function(){return[]};
g.T(ic9,H_);ic9.prototype.L=function(){return[]};
g.T(D2l,H_);D2l.prototype.L=function(){return[]};
g.T($2D,H_);$2D.prototype.L=function(){return[]};
g.T(j67,H_);j67.prototype.L=function(){return[]};
g.T(erH,H_);erH.prototype.L=function(){return[]};
g.T(CQp,H_);CQp.prototype.L=function(){return[]};
g.T(AWY,H_);AWY.prototype.L=function(){return[]};
g.T(p8$,H_);p8$.prototype.L=function(){return[]};
g.T(EkC,H_);EkC.prototype.L=function(){var F=[];this.Y.trackDownloadMetadatas&&F.push.apply(F,g.r(this.Y.trackDownloadMetadatas));return[].concat(g.r(new Set(F)))};
g.T(X8G,H_);
X8G.prototype.L=function(){var F=[];this.Y.downloadedTracks&&F.push.apply(F,g.r(this.Y.downloadedTracks));this.Y.smartDownloadedTracks&&F.push.apply(F,g.r(this.Y.smartDownloadedTracks));this.Y.downloadedEpisodes&&F.push.apply(F,g.r(this.Y.downloadedEpisodes));this.Y.downloadedAlbumReleases&&F.push.apply(F,g.r(this.Y.downloadedAlbumReleases));this.Y.smartDownloadedAlbumReleases&&F.push.apply(F,g.r(this.Y.smartDownloadedAlbumReleases));this.Y.downloadedPlaylists&&F.push.apply(F,g.r(this.Y.downloadedPlaylists));this.Y.smartDownloadedPlaylists&&
F.push.apply(F,g.r(this.Y.smartDownloadedPlaylists));this.Y.metadataOnlyTracks&&F.push.apply(F,g.r(this.Y.metadataOnlyTracks));return[].concat(g.r(new Set(F)))};
g.T(qQn,H_);qQn.prototype.L=function(){var F=[];this.Y.trackDownloadMetadatas&&F.push.apply(F,g.r(this.Y.trackDownloadMetadatas));return[].concat(g.r(new Set(F)))};
g.T(NHp,H_);NHp.prototype.L=function(){var F=[];this.Y.playbackData&&F.push(this.Y.playbackData);this.Y.localImageEntities&&F.push.apply(F,g.r(this.Y.localImageEntities));this.Y.videoDownloadContextEntity&&F.push(this.Y.videoDownloadContextEntity);return[].concat(g.r(new Set(F)))};
g.T(umC,H_);umC.prototype.L=function(){var F=[];this.Y.musicLibraryStatusEntity&&F.push(this.Y.musicLibraryStatusEntity);this.Y.primaryArtists&&F.push.apply(F,g.r(this.Y.primaryArtists));this.Y.details&&F.push(this.Y.details);this.Y.userDetails&&F.push(this.Y.userDetails);this.Y.tracks&&F.push.apply(F,g.r(this.Y.tracks));this.Y.share&&F.push(this.Y.share);this.Y.downloadMetadata&&F.push(this.Y.downloadMetadata);this.Y.refresh&&F.push(this.Y.refresh);return[].concat(g.r(new Set(F)))};
g.T(w8p,H_);w8p.prototype.L=function(){var F=[];this.Y.albumRelease&&F.push(this.Y.albumRelease);this.Y.tracks&&F.push.apply(F,g.r(this.Y.tracks));return[].concat(g.r(new Set(F)))};
g.T(m2$,H_);m2$.prototype.L=function(){var F=[];this.Y.albumRelease&&F.push(this.Y.albumRelease);return[].concat(g.r(new Set(F)))};
g.T(THH,H_);THH.prototype.L=function(){var F=[];this.Y.details&&F.push(this.Y.details);this.Y.userDetails&&F.push(this.Y.userDetails);return[].concat(g.r(new Set(F)))};
g.T(lOV,H_);lOV.prototype.L=function(){var F=[];this.Y.parentArtist&&F.push(this.Y.parentArtist);return[].concat(g.r(new Set(F)))};
g.T(Q6A,H_);Q6A.prototype.L=function(){var F=[];this.Y.parentArtist&&F.push(this.Y.parentArtist);return[].concat(g.r(new Set(F)))};
g.T(hrG,H_);hrG.prototype.L=function(){return[]};
g.T(s6G,H_);s6G.prototype.L=function(){return[]};
g.T(rWA,If);rWA.prototype.L=function(){var F=[];this.Y.creatorEntity&&F.push(this.Y.creatorEntity);return[].concat(g.r(new Set(F)))};
g.T(BHY,H_);
BHY.prototype.L=function(){var F=[];this.Y.tracks&&F.push.apply(F,g.r(this.Y.tracks));this.Y.refresh&&F.push(this.Y.refresh);this.Y.musicLibraryStatusEntity&&F.push(this.Y.musicLibraryStatusEntity);this.Y.details&&F.push(this.Y.details);this.Y.downloadMetadata&&F.push(this.Y.downloadMetadata);this.Y.sideloadMetadata&&F.push(this.Y.sideloadMetadata);this.Y.userDetails&&F.push(this.Y.userDetails);this.Y.entryCollection&&F.push(this.Y.entryCollection);this.Y.share&&F.push(this.Y.share);this.Y.podcastShowAdditionalMetadata&&F.push.apply(F,
g.r((new rWA(this.Y.podcastShowAdditionalMetadata)).L()));return[].concat(g.r(new Set(F)))};
g.T(GyC,H_);GyC.prototype.L=function(){return[]};
g.T(U2$,H_);
U2$.prototype.L=function(){var F=[];this.Y.musicLibraryStatusEntity&&F.push(this.Y.musicLibraryStatusEntity);this.Y.artists&&F.push.apply(F,g.r(this.Y.artists));this.Y.audioModeVersion&&F.push(this.Y.audioModeVersion);this.Y.videoModeVersion&&F.push(this.Y.videoModeVersion);this.Y.userDetails&&F.push(this.Y.userDetails);this.Y.details&&F.push(this.Y.details);this.Y.albumRelease&&F.push(this.Y.albumRelease);this.Y.share&&F.push(this.Y.share);this.Y.libraryEdit&&F.push(this.Y.libraryEdit);this.Y.downloadMetadata&&
F.push(this.Y.downloadMetadata);this.Y.playbackPosition&&F.push(this.Y.playbackPosition);this.Y.lyrics&&F.push(this.Y.lyrics);return[].concat(g.r(new Set(F)))};
g.T(t3p,H_);t3p.prototype.L=function(){var F=[];this.Y.parentTrack&&F.push(this.Y.parentTrack);return[].concat(g.r(new Set(F)))};
g.T(Zc9,H_);Zc9.prototype.L=function(){var F=[];this.Y.parentTrack&&F.push(this.Y.parentTrack);return[].concat(g.r(new Set(F)))};
g.T(vk$,H_);vk$.prototype.L=function(){return[]};
g.T(cWn,H_);cWn.prototype.L=function(){return[]};
g.T(PQ9,H_);PQ9.prototype.L=function(){return[]};
g.T(Oct,H_);Oct.prototype.L=function(){return[]};
g.T(V3n,H_);V3n.prototype.L=function(){var F=[];this.Y.transfer&&F.push(this.Y.transfer);this.Y.adsPlaybackData&&F.push.apply(F,g.r(this.Y.adsPlaybackData));this.Y.drmLicense&&F.push(this.Y.drmLicense);this.Y.offlineVideoPolicy&&F.push(this.Y.offlineVideoPolicy);this.Y.videoDownloadContextEntity&&F.push(this.Y.videoDownloadContextEntity);return[].concat(g.r(new Set(F)))};
g.T(IO$,H_);IO$.prototype.L=function(){return[]};
g.T(HcC,H_);HcC.prototype.L=function(){var F=[];this.Y.offlineVideoStreams&&F.push.apply(F,g.r(this.Y.offlineVideoStreams));this.Y.captionTrack&&F.push.apply(F,g.r(this.Y.captionTrack));return[].concat(g.r(new Set(F)))};
g.T(aOH,H_);aOH.prototype.L=function(){return[]};
g.T(SQV,H_);SQV.prototype.L=function(){return[]};
g.T(bcA,H_);bcA.prototype.L=function(){return[]};
g.T(d2Y,H_);d2Y.prototype.L=function(){return[]};
g.T(JW$,H_);JW$.prototype.L=function(){return[]};
g.T(yWV,H_);yWV.prototype.L=function(){return[]};
g.T(RrD,H_);RrD.prototype.L=function(){return[]};
g.T(gkV,H_);gkV.prototype.L=function(){return[]};
g.T(YQn,H_);YQn.prototype.L=function(){return[]};
g.T(nk9,H_);nk9.prototype.L=function(){return[]};
g.T(M37,H_);M37.prototype.L=function(){return[]};
g.T(LGH,H_);LGH.prototype.L=function(){return[]};
g.T(fOG,H_);fOG.prototype.L=function(){return[]};
g.T(KGC,H_);KGC.prototype.L=function(){return[]};
g.T(WGD,H_);WGD.prototype.L=function(){return[]};
g.T(F8C,H_);F8C.prototype.L=function(){return[]};
g.T(kO$,H_);kO$.prototype.L=function(){return[]};
g.T(oQG,H_);oQG.prototype.L=function(){return[]};
g.T(zip,H_);zip.prototype.L=function(){return[]};
g.T(xOD,H_);xOD.prototype.L=function(){return[]};
var krl=["browse","music/browse","unplugged/browse"],DdA=["offline/playlist_sync_check"],gmG=["offline"],o2n=["offline/offline_video_playback_position_sync"],xdY=["offline/get_playback_data_entity"],af;SV.getInstance=function(){return g.O(function(F){return F.return(new Promise(function(k){g.DZ().then(function(z){z?(SV.instance||(SV.instance=new SV(z)),k(SV.instance)):k(void 0)})}))})};
SV.prototype.get=function(F){var k=this,z,x,D;return g.O(function(e){if(e.Y==1)return g.c(e,jYH(k.token),2);if(e.Y!=3)return z=e.L,g.c(e,z.get("prefs",F),3);x=e.L;if(!x)return e.return();D=(0,g.VE)();return x.expirationTimestampMs<=D?e.return():e.return(x.value)})};
SV.prototype.set=function(F,k,z){z=z===void 0?31536E3:z;var x=this,D,e,C;return g.O(function(p){if(p.Y==1)return D=(0,g.VE)(),e={key:F,value:k,expirationTimestampMs:D+z*1E3},g.c(p,jYH(x.token),2);C=p.L;return g.c(p,g.d3(C,"prefs",e),0)})};
SV.prototype.remove=function(F){var k=this,z;return g.O(function(x){if(x.Y==1)return g.c(x,jYH(k.token),2);z=x.L;return g.c(x,z.delete("prefs",F),0)})};
g.T(b5,g.Fa);g.T(dr,EQV);dr.prototype.U=function(F,k){k=q0t(k);F=(new TextEncoder).encode(JSON.stringify(F));return this.Y.encrypt(F,k)};
dr.prototype.L=function(F,k){if(!(F instanceof Uint8Array))throw eiC(1);var z=new TextDecoder;k=q0t(k);F=this.Y.decrypt(F,k);return JSON.parse(z.decode(F))};
var NQD={accountLinkStatusEntity:vDH,booleanEntity:Q49,buttonEntity:fOG,captionTrack:vk$,channelHandle:TlD,commerceAcquisitionClientPayloadEntity:WGD,commerceCartListEntity:F8C,contextNoteFeedEntityPayload:lEt,continuationTokenEntity:YFC,downloadQualityPickerEntity:VK9,downloadsPageRefreshTokenEntity:Hf7,downloadsPageViewConfigurationEntity:okG,downloadStatusEntity:IEV,dismissState:RrD,sfvAudioItemCurrentlyPlayingEntity:d2Y,emojiFountainDataEntity:M37,emojiCustomizationSetEntity:nk9,fakeChannel:s4C,
fakePlaylist:raC,fakePlaylistEntryCollection:GiV,fakeVideo:Ur$,fakeVideoDescription:tKV,featuredProductsEntity:CQp,flowStateEntity:Zf$,iconBadgeEntity:kO$,interstitialInteractionStateEntity:P8$,likeButtonAnimationEntity:zrY,liveChatPollStateEntity:OfC,liveViewerLeaderboardChatEntryPointStateEntity:SQV,liveViewerLeaderboardPointsEntity:bcA,liveReactionsDataEntity:LGH,logoEntity:caC,macroMarkerEntity:x2$,mainDownloadsLibraryEntity:aE$,mainDownloadsListEntity:bf7,mainPlaylistDownloadStateEntity:drV,
mainPlaylistEntity:nDn,mainPlaylistVideoEntity:MKn,mainVideoDownloadStateEntity:JaD,mainVideoEntity:W$n,markersEngagementPanelSyncEntity:ic9,markersVisibilityOverrideEntity:D2l,musicAlbumReleaseDetail:w8p,musicAlbumReleaseDownloadMetadataEntity:EkC,musicAlbumRelease:umC,musicAlbumReleaseUserDetail:m2$,musicArtistDetail:lOV,musicArtist:THH,musicArtistUserDetail:Q6A,musicDownloadsLibraryEntity:X8G,musicLibraryEdit:hrG,musicLibraryStatusEntity:s6G,musicPlaylist:BHY,musicPlaylistDownloadMetadataEntity:qQn,
musicShare:GyC,musicTrackDetail:t3p,musicTrackDownloadMetadataEntity:NHp,musicTrack:U2$,musicTrackUserDetail:Zc9,offlineOrchestrationActionWrapperEntity:cWn,offlineVideoPolicy:PQ9,offlineVideoStreams:Oct,offlineabilityEntity:yan,orchestrationWebSamplingEntity:ROH,pageHeaderEntity:gkV,pdpStateEntity:oQG,pinnedProductEntity:AWY,playbackData:V3n,playerStateEntity:$2D,quantityIncrementerEntity:zip,refresh:IO$,saveToPlaylistListEntity:JW$,settingEntity:yWV,stringEntity:hOC,suggestedFeedbackChipStateEntity:j67,
transfer:HcC,trendingOfferEntity:p8$,videoDownloadContextEntity:aOH,videoOverviewAsyncDataEntity:xOD,videoPlaybackPositionEntity:KGC,votingEntity:YQn,ytMainChannelEntity:FG7,youchatPendingResponseEntity:erH,ytMainDownloadedVideoEntity:gD7,ytMainVideoEntity:kyC};g.T(nO,EQV);nO.prototype.U=function(F){return F};
nO.prototype.L=function(F){if(F instanceof Uint8Array)throw eiC(0);return F};
g.T(MV,g.S);MV.prototype.observe=function(F){var k=this;this.observers.push(F);return function(){var z=k.observers.indexOf(F);z>=0&&k.observers.splice(z,1)}};
MV.prototype.L=function(F){ZVD(this,F.data)};
MV.prototype.h4=function(){this.channel.close()};
var VUA,vmD=new g.Z3("elementsCommand");var so=new g.Z3("entityBatchUpdate");var ml$=new g.Z3("downloadStatusEntity");var VdC=new g.Z3("mainPlaylistEntityActionMetadata");var Ly=new g.Z3("mainVideoEntityActionMetadata");var R4$=new g.Z3("musicPlaylistEntityActionMetadata");var NUC=new g.Z3("musicTrackEntityActionMetadata");var fet=new g.Z3("localImageEntityActionMetadata");var V2=new g.Z3("playbackDataActionMetadata");var cCA=new g.Z3("transferEntityActionMetadata");var uR9=new g.Z3("videoPlaybackPositionEntityActionMetadata");var ftl;new g.Zd;new g.Zd;omV.prototype.request=function(F,k,z){k=k===void 0?{}:k;return this.locks.request(F,k,function(x){return z(x)})};var zq=g.bD.caches,o8,$ln;kv.prototype.open=function(F){return zq.open(iT7(F))};
kv.prototype.has=function(F){return zq.has(iT7(F))};
kv.prototype.delete=function(F){return zq.delete(iT7(F))};
kv.prototype.match=function(F,k){var z=this,x,D,e,C,p,E;return g.O(function(X){switch(X.Y){case 1:return g.c(X,z.keys(),2);case 2:x=X.L,D=g.l(x),e=D.next();case 3:if(e.done){X.Sk(5);break}C=e.value;return g.c(X,z.open(C),6);case 6:return p=X.L,g.c(X,p.match(F,k),7);case 7:if(E=X.L)return X.return(E);e=D.next();X.Sk(3);break;case 5:return X.return()}})};
g.T(xlV,kv);xlV.prototype.keys=function(){var F,k,z,x,D,e,C,p,E;return g.O(function(X){if(X.Y==1)return F=[],k=g.kK("CacheStorage keys"),g.c(X,zq.keys(),2);z=X.L;x=g.l(z);for(D=x.next();!D.done;D=x.next()){e=D.value;var q=e.indexOf(":");C=q===-1?{Np:e}:{Np:e.substring(0,q),datasyncId:e.substring(q+1)};p=C.Np;E=C.datasyncId;E===k&&F.push(p)}return X.return(F)})};g.T(iS,g.S);iS.prototype.U=function(F){this.api.ZQ("onOfflineOperationFailure",F.data)};
iS.prototype.j=function(F){this.api.publish("offlinetransferpause",F.data)};
iS.prototype.h4=function(){var F;(F=this.Y)==null||F.close();var k;(k=this.L)==null||k.close()};CRD.prototype.FA=function(){this.Y&&$v(this)};
CRD.prototype.WL=function(){this.L&&this.L.resolve();this.U=this.Y=!1;this.K()};var Mup=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var Ulp="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var SgG="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.T(jCY,cd);jCY.prototype.L=function(F){return AG(F)?ACC(this,F):py(F)?XND(this,F):Promise.reject(Error("Unsupported action type: "+F.actionType))};g.T(qXA,cd);qXA.prototype.L=function(F){return py(F)?NYG(this,F):wKn(F)?wNG(this,F):Eo(F)?md$(this,F):Promise.reject(Error("Unsupported action type: "+F.actionType))};g.A=TYD.prototype;g.A.Vrp=function(F){var k=this,z,x,D,e;return g.O(function(C){if(!g.n(F.state,128))return C.Sk(0);z=F.state.YA;var p=(x=z)==null?void 0:x.errorCode,E=(D=z)==null?void 0:D.Oy;e=p==="net.connect"&&E===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(p==null?0:p.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.c(C,k.Hv(k.player.getVideoData().videoId,e),0)})};
g.A.Hv=function(F,k){var z=this;return g.O(function(x){if(x.Y==1){if(z.L)return x.return();z.L=!0;return k==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(a8(z,F,!1,!0),x.Sk(0)):g.c(x,Hd(z,F),3)}g.v3(F,4);return g.c(x,z.Y.Hv(k),0)})};
g.A.bb=function(F){F.status===2?(F.status!==this.U&&(N6$(this.Y),g.v3(F.videoId,2)),F.jS&&leA(this.Y,F.videoId,F.jS)):F.status===4?(Hd(this,F.videoId),this.Hv(F.videoId,F.Pk?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):F.status===1&&T6H(this.Y);this.U=F.status;this.api.ZQ("localmediachange",{videoId:F.videoId,status:F.status})};
g.A.Q5=function(){var F=this,k;return g.O(function(z){if(z.Y==1){if(F.L)return z.return();F.L=!0;k=F.player.getVideoData().videoId;return g.c(z,Hd(F,k),2)}return g.c(z,F.Y.Q5(),0)})};
g.A.f2=function(F){switch(F){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.A.V=function(F){return this.api.C().V(F)};g.T(GrH,cd);GrH.prototype.L=function(F){return AG(F)?tuH(this,F):py(F)?ZSt(this,F):wKn(F)?v2p(this,F):Promise.reject(Error("Unsupported action type: "+F.actionType))};HSp.prototype.Y=function(F,k){var z=F.action.actionMetadata.priority-k.action.actionMetadata.priority;z===0&&(F.Y<k.Y?z=-1:F.Y>k.Y&&(z=1));return z};g.T(SO,g.S);SO.prototype.h4=function(){this.K&&this.K();g.S.prototype.h4.call(this)};
SO.prototype.createAction=function(F,k){var z=g.xW(F.entityKey).entityType,x=g.vt(16);return new wD(z,x,F,k.actionId,k.rootActionId)};
SO.prototype.PR=function(F){var k=this,z,x,D,e,C,p,E,X,q;return g.O(function(N){if(N.Y==1){if(k.z4())return N.return();x=(z=F.offlineOrchestrationActionWrapperEntity)!=null?z:new Set;D=[];e=g.l(x);for(C=e.next();!C.done;C=e.next())p=C.value,E=g.xW(p),X=E.entityId,bSA(k.Y,X)||D.push(p);return g.c(N,K6Y(k,D),2)}q=N.L;return g.c(N,fvD(k,q),0)})};
SO.prototype.retry=function(){var F=this;return g.O(function(k){return g.c(k,W6C(F),0)})};klt.prototype.C$=function(F,k){k=k===void 0?!0:k;var z=this,x,D,e,C,p,E,X,q;return g.O(function(N){switch(N.Y){case 1:if(!z.Y)return N.return();x=[];D=g.o7(z.Y.L,k);e=[];for(C={oF:0};C.oF<D.length;C={oF:C.oF},C.oF++)p=D[C.oF],E=z.Y.WD(p,"json3"),X=g.Pp(E,{withCredentials:!0,format:"RAW"},3,500).then(function(u){return function(w){w={metadata:g.Nk(D[u.oF]),trackData:w.xhr.responseText};e.push(w)}}(C)).UT(function(u){xv("Caption fetch error",u)}),x.push(X);
return g.c(N,mrn(x),2);case 2:return g.lD(N,3),g.c(N,y9C(F,e),5);case 5:g.sC(N,0);break;case 3:q=g.rI(N),xv("Caption DB transaction error",q),g.Tp(N)}})};g.T(bS,g.S);bS.prototype.h4=function(){this.L&&this.L();g.S.prototype.h4.call(this)};
bS.prototype.U=function(F){var k=this,z,x,D,e,C,p,E,X;return g.O(function(q){x=(z=F.transfer)!=null?z:new Set;D=[];e=g.l(x);for(C=e.next();!C.done;C=e.next())p=C.value,E=g.xW(p),X=E.entityId,D.push(X);return D.length===0?q.return():g.c(q,xgl(k,D),0)})};g.T(e6$,g.S);g.A=e6$.prototype;g.A.h4=function(){this.t4&&this.t4();this.mp.dispose();this.j.dispose();this.cR&&g.Fz(this.S.ME,this.cR);this.yh&&g.Fz(this.S.ME,this.yh);g.S.prototype.h4.call(this)};
g.A.U0R=function(F){var k=this,z,x,D;return g.O(function(e){switch(e.Y){case 1:z=g.is(F,"transfer");if(k.Y&&z===k.Y.key){a8(k.G,k.W,!0);k.j.stop();e.Sk(0);break}return g.c(e,LO(k.L,{mode:"readwrite",nN:!0},function(C){return Jp(C,z,"transfer").then(function(p){if(p&&p.transferState!=="TRANSFER_STATE_COMPLETE"&&p.transferState!=="TRANSFER_STATE_FAILED")return p.transferState="TRANSFER_STATE_PAUSED_BY_USER",gr(C,p,"transfer").then(function(){return p})})}),3);
case 3:x=e.L;if(!x){e.Sk(0);break}if(!F||!k.U){e.Sk(5);break}return g.c(e,XL(F,k.U,k.L,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.c(e,y2(k,F),7);case 7:D=e.L,NCC({videoId:F,Tu:x,offlineModeType:D}),g.Tp(e)}})};
g.A.LEt=function(){var F=this;if(this.Y&&this.W){a8(this.G,this.W,!1);var k=this.Y,z=(k==null?0:k.key)?g.xW(k.key).entityId:"";z&&this.U&&(new Promise(function(x,D){XL(z,F.U,F.L,"DOWNLOAD_STATE_PAUSED").catch(function(e){D(e)})})).catch(function(x){xv("Download state setting error",x)})}this.j.stop()};
g.A.Jt=function(){this.Y?pjl(this,this.Y):JG(this)};
g.A.ir=function(F){var k=this;return g.O(function(z){switch(z.Y){case 1:if(!k.Y){z.Sk(2);break}if(k.Y.transferState==="TRANSFER_STATE_COMPLETE"||k.Y.transferState==="TRANSFER_STATE_FAILED"||!F.transfer||!F.transfer.has(k.Y.key)){z.Sk(3);break}return g.c(z,KO(k.L,k.Y.key,"transfer"),4);case 4:k.Y=z.L;if(k.Y){z.Sk(3);break}return g.c(z,EeD(k),3);case 3:if(k.Y)return z.return();case 2:return g.c(z,JG(k),0)}})};
g.A.Hv=function(F,k){var z=this,x,D,e,C,p;return g.O(function(E){switch(E.Y){case 1:if(!z.Y){R8(z,"onTransferFailure: "+F);E.Sk(2);break}x=z.Y;e=((D=x)==null?0:D.key)?g.xW(x.key).entityId:"";a:switch(F){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var X=!1;break a;default:X=!0}return X&&QRV(z)?g.c(E,gD(z,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.c(E,
h67(z,F),5);case 5:if(!e||!z.U){E.Sk(2);break}return g.c(E,XL(e,z.U,z.L,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.c(E,y2(z,e),9);case 9:C=E.L;eO({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:e,Tu:x,offlineModeType:C});if(!e||!z.U){E.Sk(2);break}return g.c(E,XL(e,z.U,z.L,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:dD(z),p=JG(z,!0),k&&k(p),g.Tp(E)}})};
g.A.Q5=function(F){var k=this,z,x,D,e,C,p,E,X,q,N,u,w;return g.O(function(m){switch(m.Y){case 1:if(!k.Y){R8(k,"onMaybeTransferStreamsExpired");m.Sk(2);break}return QRV(k)?g.c(m,gD(k,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.c(m,h67(k,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!k.U){m.Sk(2);break}z=k.Y;D=((x=z)==null?0:x.key)?g.xW(z.key).entityId:"";if(!D){m.Sk(2);break}return g.c(m,XL(D,k.U,k.L,"DOWNLOAD_STATE_FAILED"),2);case 9:return k.Y||R8(k,"onMaybeTransferStreamsExpiredRetryAttempting"),
e=k.Y,p=((C=e)==null?0:C.key)?g.xW(e.key).entityId:"",g.c(m,y2(k,p),10);case 10:return E=m.L,eO({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:p,Tu:e,offlineModeType:E}),X=QmV(),g.ME(X,V2,{isEnqueuedForExpiredStreamUrlRefetch:!0}),q=g.is(p,"playbackData"),N={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:q,actionMetadata:X},u=Tq(new wD("playbackData",p,N)),g.c(m,fO(k.L,u,"offlineOrchestrationActionWrapperEntity"),2);case 2:dD(k),w=JG(k,!0),
F&&F(w),g.Tp(m)}})};
var GsC={},sRC=(GsC.TRANSFER_STATE_TRANSFERRING=1,GsC.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,GsC);g.A=Yv.prototype;g.A.Mg=function(){return this.W.promise};
g.A.OP=function(){if(this.L&&this.G)return this.W.promise;GlC(this).then(this.W.resolve).catch(this.W.reject);return this.W.promise};
g.A.t8=function(F){var k={};return k.playbackData=new jCY(F,this.YG,this.Y),k.transfer=new GrH(F,this.YG),k.videoPlaybackPositionEntity=new qXA(F,this.YG),k};
g.A.XR=function(){var F=this;return g.O(function(k){return F.L?g.c(k,CT$(F.L),0):k.Sk(0)})};
g.A.dN=function(){var F=this,k,z;return g.O(function(x){if(x.Y==1)return F.L||F.G?g.c(x,F.Mg(),2):x.return();F.B!==void 0&&(g.QL(F.B),F.B=void 0);F.j!==void 0&&(g.QL(F.j),F.j=void 0);(k=F.L)==null||k.dispose();F.L=void 0;(z=F.G)==null||z.dispose();F.G=void 0;F.api.ZQ("onOrchestrationLostLeader");F.W=new g.Zd;g.Tp(x)})};
g.A.isOrchestrationLeader=function(){return this.U.Y};
g.A.QU=function(){return g.O(function(F){return F.return(!1)})};
g.A.qO=function(F){var k=this.Y;k.api.publish("offlinetransferpause",F);var z;(z=k.L)==null||z.postMessage(F)};
g.A.Jt=function(F){var k,z;return g.O(function(x){if(x.Y==1)return g.c(x,FL(),2);k=x.L;if(!k)return x.return();z=g.is(F,"transfer");return g.c(x,LO(k,{mode:"readwrite",nN:!0},function(D){var e=Jp(D,z,"transfer"),C=Jp(D,g.is(F,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.vA.all([e,C]).then(function(p){p=g.l(p);var E=p.next().value;var X=p.next().value;return E&&E.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(E.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",gr(D,E,"transfer").then(function(){eO({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:F,Tu:E,offlineModeType:X==null?void 0:X.offlineModeType});return g.vA.resolve(null)})):g.vA.resolve(null)})}),0)})};
g.A.KA=function(F){F=F===void 0?43200:F;var k=this,z,x,D,e,C,p,E,X;return g.O(function(q){if(q.Y==1)return k.S.bG()?g.c(q,FL(),2):q.return(UgG());if(q.Y!=3){z=q.L;if(!z)return q.return([]);x=Date.now()/1E3;return g.c(q,W_(z,"offlineVideoPolicy"),3)}D=q.L;e=[];C=g.l(D);for(p=C.next();!p.done;p=C.next())E=p.value,Number(E.lastUpdatedTimestampSeconds)+F<=x&&(X=g.xW(E.key).entityId,e.push(X));return e.length?q.return(ny(k,e,k.K,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):q.return([])})};
g.A.deleteAll=function(){return ny(this,["!*$_ALL_ENTITIES_!*$"],this.K,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.A.refreshAllStaleEntities=function(F){var k=this;return g.O(function(z){return z.Y==1?g.c(z,k.KA(F),2):z.return(z.L)})};
g.A.setUpPositionSyncInterval=function(F){var k=this;this.j!==void 0&&(g.QL(this.j),this.j=void 0);var z=F!=null?F:864E5;this.j=g.TE(function(){k.j8(z)},z)};
g.A.j8=function(F){var k=this,z,x,D,e,C,p;return g.O(function(E){switch(E.Y){case 1:return g.lD(E,2),g.c(E,SV.getInstance(),4);case 4:z=E.L;if(!z)throw Error("prefStorage is undefined");return g.c(E,z.get("psi"),5);case 5:x=E.L;e=((D=x)==null?0:D.au)?Number(x.au)/1E3:0;C=Date.now();if(!(e+F<=C)){E.Sk(6);break}return g.c(E,ny(k,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.sC(E,0);break;case 2:p=g.rI(E),xv("Offline manager error",p),
g.Tp(E)}})};
g.A.iQ=function(){var F=this,k,z,x,D,e,C,p;return g.O(function(E){if(E.Y==1)return g.c(E,FL(),2);if(E.Y!=3)return(k=E.L)?g.c(E,W_(k,"transfer"),3):E.return([]);z=E.L;x=[];D=g.l(z);for(e=D.next();!e.done;e=D.next())C=e.value,C.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&C.key&&(p=g.xW(C.key).entityId,x.push(p));return E.return(Z6n(F,x))})};
g.A.y4=function(){return g.O(function(F){return F.return([])})};
g.A.Df=function(){return g.O(function(F){g.Tp(F)})};
g.A.jY=function(){return g.O(function(F){g.Tp(F)})};g.T(ve$,cd);ve$.prototype.L=function(F){return AG(F)?O67(this,F):py(F)?Ie$(this,F):Eo(F)?H6C(this,F):Promise.reject(Error("Unsupported action type: "+F.actionType))};
var MP=[10];g.T(JFl,cd);JFl.prototype.L=function(F){return AG(F)?geY(this,F):py(F)?YWp(this,F):Eo(F)?neA(this,F):Promise.reject(Error("Unsupported action type: "+F.actionType))};
var R67=[10];g.T(LC$,cd);LC$.prototype.L=function(F){return py(F)?KCH(this,F):Promise.reject(Error("Unsupported action type: "+F.actionType))};g.T(WCH,Yv);g.A=WCH.prototype;g.A.t8=function(F){var k=Yv.prototype.t8.call(this,F);k.mainVideoEntity=new JFl(F,this.YG,this.Y);k.mainPlaylistEntity=new ve$(F,this.YG,this.Y);k.mainDownloadsListEntity=new LC$(F,this.YG,this.Y);return k};
g.A.refreshAllStaleEntities=function(F,k){var z=this,x,D,e,C,p,E,X,q,N,u,w;return g.O(function(m){switch(m.Y){case 1:x=[];if(!z.YG.V("web_player_offline_playlist_auto_refresh")){m.Sk(2);break}return g.c(m,F3t(z,F,k),3);case 3:x=m.L;case 2:return g.c(m,SV.getInstance(),4);case 4:return D=m.L,g.c(m,(e=D)==null?void 0:e.get("sdois"),5);case 5:return C=m.L,g.c(m,(p=D)==null?void 0:p.get("lmqf"),6);case 6:E=m.L;if(!C){m.Sk(7);break}q=x;N=q.concat;return g.c(m,ks$(z,C,(X=E)!=null?X:"SD",F===0),8);case 8:x=
N.call(q,m.L);case 7:return u=x,w=u.concat,g.c(m,Yv.prototype.refreshAllStaleEntities.call(z,F,k),9);case 9:return x=w.call(u,m.L),m.return(x)}})};
g.A.QU=function(F){var k,z,x,D,e,C,p,E;return g.O(function(X){if(X.Y==1)return g.c(X,FL(),2);if(X.Y!=3)return(k=X.L)?g.c(X,KO(k,g.P$,"mainDownloadsListEntity"),3):X.return(!1);z=X.L;if((x=z)==null?0:(D=x.downloads)==null?0:D.length)for(e=g.is(F,"mainVideoEntity"),C=g.l(z.downloads),p=C.next();!p.done;p=C.next())if(E=p.value,E.videoItem===e)return X.return(!0);return X.return(!1)})};
g.A.y4=function(){var F=this,k,z,x,D,e,C,p,E;return g.O(function(X){if(X.Y==1)return g.c(X,FL(),2);if(X.Y!=3)return(k=X.L)?g.c(X,W_(k,"downloadStatusEntity"),3):X.return([]);z=X.L;x=[];D=g.l(z);for(e=D.next();!e.done;e=D.next())C=e.value,C.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&C.key&&(p=g.xW(C.key).entityId,x.push(p));return x.length?(E={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},X.return(ny(F,x,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
E))):X.return([])})};
g.A.jY=function(){var F;return g.O(function(k){return k.Y==1?g.c(k,FL(),2):(F=k.L)?g.c(k,LO(F,{mode:"readwrite",nN:!0},function(z){return yh(z,"mainVideoEntity").then(function(x){var D=[];x=g.l(x);for(var e=x.next();!e.done;e=x.next()){e=e.value;var C=void 0;(C=e.userState)!=null&&C.playbackPosition||(C=g.xW(e.key).entityId,C={key:g.is(C,"videoPlaybackPositionEntity"),videoId:C,lastPlaybackPositionSeconds:"0"},D.push(gr(z,C,"videoPlaybackPositionEntity")),e.userState={playbackPosition:C.key},D.push(gr(z,
e,"mainVideoEntity")))}return g.vA.all(D)})}),0):k.return()})};
g.A.Df=function(){var F,k,z,x,D,e,C,p,E,X,q,N,u,w,m,h,B,U,v,P,I,d,W,M,xY,$Y,Fx,y,K,Q,R,Jn,s$,u7,Gp,kG,jC,w9;return g.O(function(G){if(G.Y==1)return g.c(G,FL(),2);if(G.Y!=3){F=G.L;if(!F)return G.return();k=g.is("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.c(G,LO(F,{mode:"readonly",nN:!0},function(t){return g.vA.all([Jp(t,k,"mainDownloadsListEntity"),Jp(t,g.P$,"mainDownloadsListEntity"),yh(t,"mainVideoEntity"),yh(t,"mainPlaylistEntity")])}),3)}z=G.L;
x=g.l(z);D=x.next().value;e=x.next().value;C=x.next().value;p=x.next().value;E=D;X=e;q=C;N=p;u=new Set;if((w=E)==null?0:(m=w.downloads)==null?0:m.length)for(h=g.l(E.downloads),B=h.next();!B.done;B=h.next())U=B.value,v=void 0,(P=(v=U.videoItem)!=null?v:U.playlistItem)&&u.add(P);if((I=X)==null?0:(d=I.downloads)==null?0:d.length)for(W=g.l(X.downloads),M=W.next();!M.done;M=W.next())xY=M.value,xY.videoItem&&u.add(xY.videoItem);$Y=new Set;Fx=[];y=g.l(N);for(K=y.next();!K.done;K=y.next()){Q=K.value;if(Q.videos)for(R=
g.l(Q.videos),Jn=R.next();!Jn.done;Jn=R.next())s$=Jn.value,(u7=JSON.parse(g.xW(s$).entityId).videoId)&&$Y.add(u7);Q.key&&!u.has(Q.key)&&Fx.push(Q.key)}Gp=g.l(q);for(kG=Gp.next();!kG.done;kG=Gp.next())jC=kG.value,jC.key&&!u.has(jC.key)&&(w9=g.xW(jC.key).entityId,$Y.has(w9)||Fx.push(jC.key));return Fx.length?g.c(G,VrA(F,Fx),0):G.Sk(0)})};g.T(ocC,cd);ocC.prototype.L=function(F){return AG(F)?xJt(this,F):py(F)?iXA(this,F):Eo(F)?DJ$(this,F):Promise.reject(Error("Unsupported action type: "+F.actionType))};
var fy=[10];g.T(jAA,cd);jAA.prototype.L=function(F){return AG(F)?C1l(this,F):py(F)?AUG(this,F):Eo(F)?pIG(this,F):Promise.reject(Error("Unsupported action type: "+F.actionType))};
var Ky=[10];g.T(qr$,cd);qr$.prototype.L=function(F){return AG(F)?mJt(this,F):py(F)?TUC(this,F):Eo(F)?l3G(this,F):Promise.reject(Error("Unsupported action type: "+F.actionType))};
var wIH=[10];g.T(Wd,Yv);Wd.prototype.t8=function(F){var k=Yv.prototype.t8.call(this,F);k.musicTrack=new qr$(F,this.Y);k.musicPlaylist=new jAA(F,this.Y);k.musicAlbumRelease=new ocC(F,this.Y);return k};
Wd.prototype.refreshAllStaleEntities=function(F,k){var z=this,x,D,e;return g.O(function(C){if(C.Y==1)return g.c(C,hJC(z,F,k),2);if(C.Y!=3)return D=x=C.L,e=D.concat,g.c(C,Yv.prototype.refreshAllStaleEntities.call(z,F,k),3);x=e.call(D,C.L);return C.return(x)})};g.T(sAH,g.XP);g.A=sAH.prototype;g.A.create=function(){var F=this;g.b(this,this.events);g.f_(this.YG)?this.Y=new WCH(this.YG,this.player):g.g8(this.YG)&&(this.Y=new Wd(this.YG,this.player));this.events.N(this.player,"onPlaybackStartExternal",function(){F.rY()});
this.events.N(this.player,"videodatachange",function(){F.rY()});
this.YG.V("html5_offline_playback_position_sync")&&this.events.N(this.player,"presentingplayerstatechange",this.ST)};
g.A.zy=function(){return!1};
g.A.Ae=function(F,k,z,x){var D=this;return g.O(function(e){return D.Y?e.return(ny(D.Y,F,k,z,x)):e.return(Promise.reject())})};
g.A.deleteAll=function(){return this.Y.deleteAll()};
g.A.KA=function(F){return this.Y.KA(F)};
g.A.refreshAllStaleEntities=function(F){return this.Y.refreshAllStaleEntities(F)};
g.A.setUpPositionSyncInterval=function(F){this.Y.setUpPositionSyncInterval(F)};
g.A.qO=function(F){this.Y.qO(F)};
g.A.Jt=function(F){return this.Y.Jt(F)};
g.A.rY=function(){var F=this,k;return g.O(function(z){k=F.player.getVideoData();return g.M8(k)?rU7(k)&&F.L!==k.clientPlaybackNonce?g.c(z,BU9(F,k),0):z.Sk(0):z.return()})};
g.A.ST=function(F){var k=this,z,x,D,e,C,p,E;return g.O(function(X){if(X.Y==1)return z=k.player.getVideoData(),x=z.u$,g.hI(F,2)||g.hI(F,512)?g.c(X,FL(),2):X.return();if(X.Y!=3){D=X.L;if(!D)return xv("PES is undefined"),X.return();e=z.videoId;return g.c(X,KO(D,g.is(e,"mainVideoEntity"),"mainVideoEntity"),3)}C=X.L;if(!C)return X.return();p=Math.floor(x).toString();E={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:p}};return g.c(X,k.Ae([e],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
E),0)})};
g.A.isOrchestrationLeader=function(){return this.Y.isOrchestrationLeader()};
g.A.updateDownloadState=function(F,k){var z,x,D,e;return g.O(function(C){if(C.Y==1)return g.c(C,FL(),2);z=C.L;if(!z)return xv("PES is undefined"),C.return();x=g.xW(F);D=x.entityType;e=x.entityId;return g.c(C,XL(e,D,z,k,!0),0)})};g.EL("offline",sAH);})(_yt_player);
